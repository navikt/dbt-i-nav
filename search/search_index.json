{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduksjon til dbt","text":"<p>dbt (data build tool) er et SQL basert transformasjonsvekt\u00f8y som lar deg modularisere og skrive testbar SQL kode. dbt s\u00f8rger for at SQLene blir kj\u00f8rt i riktig rekkef\u00f8lge slik at sluttproduktet blir oppdatert korrekt.</p> <p>En SQL fil i dbt blir kalt en <code>modell</code> i dbt. Modeller kan materialiseres p\u00e5 ulike m\u00e5ter. Som view, tabell eller rett og slett en SQL snutt som kan gjenbrukes i flere modeller etter DRY-prinsippet. </p> <p>dbt er IKKE et extract-load verkt\u00f8y. Det betyr at dataene som skal transformeres allerede m\u00e5 ligge i databasen dbt er koblet til. dbt krever alts\u00e5 at data er lastet p\u00e5 forh\u00e5nd, med feks en pythonjobb eller kafkakonsument. Dataene trenger ikke n\u00f8dvendigvis ligge i samme komponentskjema eller samme BigQuery prosjekt. S\u00e5 lenge dataene er tilgjengelig p\u00e5 samme database og dbt service brukeren har tilgang til \u00e5 lese dataene er du good to go.</p> <p>dbt kommer b\u00e5de i som open source i form av <code>dbt-core</code> og i en egen cloud versjon, <code>dbt cloud</code>. Cloud versjonen st\u00f8tter kun skydatabaser som feks. BigQuery og Snowflake. dbt Cloud kan derfor ikke brukes mot Oracle onprem databasen til datavarehus. For datasett som befinner seg p\u00e5 datamarkedsplassen i BigQuery, kan dbt Cloud v\u00e6re en mulighet. </p> <p>For Oracle on-prem benytter vi dbt-oracle som er en python pakke som baserer seg p\u00e5 dbt-core. Oracle er ikke offisielt st\u00f8ttet av dbt, men Oracle har tatt ansvar for community connectoren og og blir aktiv vedlikeholdt og fortl\u00f8pende oppdatert til siste versjon av dbt-core.  For \u00e5 n\u00e5 on-prem Oracle m\u00e5 vi som kjent benytte utviklerimage. Denne guiden tar for seg installasjon og oppsett av dbt-oracle p\u00e5 vdi utvikler gjennom Visual Studio Code.</p>"},{"location":"#lenker","title":"Lenker","text":"<p>F\u00f8r du g\u00e5r gjennom detaljene p\u00e5 hvordan dbt b\u00f8r settes opp er det lurt \u00e5 bli kjent med hvordan dbt fungerer. Nedenfor er det et knippe nyttige lenker som hjelper deg med \u00e5 komme igang og l\u00e6re de viktigste kommandoene og funksjonene i dbt.</p>"},{"location":"#kurs-dbt-fundamentals","title":"Kurs - dbt fundamentals","text":"<p>Det er sterkt anbefalt \u00e5 starte med \u00e5 g\u00e5 gjennom fundamentals kurset til dbt labs. Dette kurset bruker dbt cloud, men mesteparten av innholdet kan overf\u00f8res til dbt-core. Bruk gjerne GCP dev milj\u00f8et til teamet for \u00e5 sette opp testprosjektet i BigQuery, men husk p\u00e5 \u00e5 slette ressursene i etterkant</p>"},{"location":"#designprinsipper","title":"Designprinsipper","text":"<p>How to design a dbt model from scratch. Hvordan b\u00f8r du tenke n\u00e5 du designer nye modeller med dbt? Det er fort gjort \u00e5 bomme p\u00e5 f\u00f8rste fors\u00f8k, og det koster mye tid.</p>"},{"location":"#dimensjonsmodellering","title":"Dimensjonsmodellering","text":"<p>Kimball er fortsatt relevant med dbt.  Building a Kimball dimensional model with dbt</p>"},{"location":"#bok","title":"Bok","text":"<p>Det er nylig (juni 2023) lansert en bok om  Data Engineering with dbt. Boken inneholder instroduksjon til data engineering generelt og endelt om ulike skydatabaser i tillegg til grunnleggende bruk av dbt. Kanskje den mest interessante delen er kapittel 8 som omhandler testing med dbt.</p>"},{"location":"#nyttige-lenker","title":"Nyttige lenker","text":"<p>dbt's egne guider: Lessons</p> <p>Community basert samling av lenker: awsome-dbt</p>"},{"location":"#hvorfor-skal-jeg-bruke-dbt-jeg-kan-jo-kjre-sql-med-python","title":"Hvorfor skal jeg bruke dbt? Jeg kan jo kj\u00f8re SQL med Python","text":"<p>Det er riktig. Dersom du bare skal kj\u00f8re noen enkle SQL sp\u00f8rringer er det kanskje like greit \u00e5 sette opp en Pythonjobb som kj\u00f8rer SQLen for deg. Men med en gang antall sp\u00f8rringer eller kompleksiteten p\u00e5 sp\u00f8rringene \u00f8ker vil dbt hjelpe med med \u00e5 strukturere koden og holde oversikt over rekkef\u00f8lgen. Det er ikke uvanlig at en komponent best\u00e5r av 30 eller flere SQL filer som avhenger av hverandre.</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt-power-user/","title":"dbt Power User","text":"<p>dbt Power User er en VS Code extension, og gir oss en rekke nyttige verkt\u00f8y, som f.eks.:</p> <ul> <li>Lekker lineage vist i VS Code </li> <li>Auto-complete dbt code</li> <li>SQL validator</li> <li>Preview query results</li> <li>En rekke snarveier, blant annet via egne knapper</li> <li>Visning av generert SQL-kode (slipper \u00e5 lete den frem i target-mappen)</li> </ul> <p>dbt Power User p\u00e5 GitHub</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt-power-user/#installasjon-og-oppsett","title":"Installasjon og oppsett","text":"<p>Installeres via VS Code Marketplace, f\u00f8lg installasjonsrutinene til Altimate</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt-power-user/#utover-standardinstallasjon-ma-flgende-hensyn-tas-for-bruk-pa-vdi-utvikler-og-mot-oracle-dvh","title":"Utover standardinstallasjon m\u00e5 f\u00f8lgende hensyn tas for bruk p\u00e5 VDI Utvikler og mot Oracle DVH:","text":"<p>dbt Power User krever at man setter opp milj\u00f8variabler med credentials via PowerShell, f\u00f8r VS Code startes opp i samme PowerShell-sesjon. Dette gj\u00f8re med skriptet start_vscode_dbt.ps1</p> <p>F\u00f8lg denne guiden for \u00e5 sette opp Visual Studio Code med riktige milj\u00f8variable:</p> <ol> <li> <p>Klon dette repoet: https://github.com/navikt/dbt-i-nav/ til en lokal mappe p\u00e5 utivklerimage/VDI</p> </li> <li> <p>Lag en snarvei p\u00e5 skrivebordet til start_vscode_dbt.ps1 som n\u00e5 ligger lokalt p\u00e5 VDI (inne i mappen du nettopp klonet) slik:     </p> </li> <li> <p>H\u00f8yreklikk p\u00e5 den nye snarveien og velg <code>Egenskaper</code> </p> </li> <li> <p>Skriptet er generelt og krever at stien til et gyldig dbt-prosjekt settes som argument i tillegg til schemanavnet dbt skal bruke som proxy. Fyll derfor inn f\u00f8lgende tekst i <code>M\u00e5l</code>: <code>powershell.exe -noexit -ExecutionPolicy Bypass -File \"C:\\sti til dbt-i-nav\\start_vscode_dbt.ps1\" c:\\sti\\til\\dbt-prosjekt\\  databaseskjemanavn</code> og juster i forhold til stiene p\u00e5 ditt image.     </p> </li> <li> <p>Kopier snarveien og endre stiene for hvert dbt prosjekt du vil sette opp</p> </li> <li> <p>Start Visual Stusdio Code ved \u00e5 dobbeltklikke p\u00e5 snarveien.</p> </li> <li> <p>Det hender skriptet oppdateres, s\u00e5 det er lurt \u00e5 hente siste kode fra github innimellom.</p> </li> </ol>"},{"location":"Installasjon-p%C3%A5-VDI/dbt-power-user/#oracle-oppsett-for-preview-query","title":"Oracle oppsett for Preview query","text":"<p>Preview query-template m\u00e5 endres for Oracle-bruk: 1. \u00c5pne Settings ved \u00e5 trykke <code>CTRL + ,</code> 2. S\u00f8k etter <code>dbt.queryTemplate</code> 3. Endre skript til <code>select * from ({query}) where ROWNUM &lt;= {limit}</code></p> <p>Ref.: #dbtquerytemplate-for-oracle</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt-power-user/#erfaringer-feil-som-har-oppstatt-ved-bruk-av-dbt-power-user","title":"Erfaringer - feil som har oppst\u00e5tt ved bruk av dbt Power User:","text":"<ul> <li>Hele dbt-prosjektet blir validert n\u00e5r prosjekt-mappen \u00e5pnes. Eventuelle initielle imports som er lagt inn i dbt_run.py, som f.eks. <code>from google.cloud import secretmanager</code>, vil gi feil i VDI Utvikler. Begrens initielle imports til grunnleggende behov.</li> </ul>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/","title":"DBT","text":""},{"location":"Installasjon-p%C3%A5-VDI/dbt/#oppsett-av-dbt-prosjekter","title":"Oppsett av dbt prosjekter","text":"<p>Vi har laget et ferdig oppsett av et dbt prosjekt tilpasset NAV dvh. Enten lag et nytt repo basert p\u00e5 dvh_template. Deretter m\u00e5 dbt_template kopieres inn for \u00e5 f\u00e5 integrert dbt prosjektet.</p> <p>Resten av denne siden omhandler manuelt oppsett av dbt-oracle uten virteul. F\u00f8lg denne guiden hvis du ikke \u00f8nsker automatisk oppsett i Visual Studio Code.</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#oppsett-av-sertifikater-til-pip","title":"Oppsett av sertifikater til pip","text":"<p>Til vanlig bruker pip sitt eget sertifikat for \u00e5 validere at vi laster ned pakker fra riktig server. Siden VDI bruker en webproxy for \u00e5 kommunisere med omverdenen vill vi f\u00e5 en feilmeling ved <code>pip install xxx</code>.</p> <p>Error</p> <pre><code>13:42:24  Encountered an error: External connection exception occurred:\nHTTPSConnectionPool(host='hub.getdbt.com', port=443): Max retries exceeded\nwith url: /api/v1/index.json (Caused by SSLError(SSLCertVerificationError(1,\n'[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get\nlocal issuer certificate (_ssl.c:1108)')))\n</code></pre> <p>For \u00e5 fikse feilen kan vi installere pakkene <code>setuptools-scm</code> og <code>pip-system-certs</code> som f\u00e5r pip til \u00e5 bruke Windows Certificate Store istedenfor.</p> <pre><code>pip install setuptools-scm pip-system-certs --trusted-host pypi.org --trusted-host  files.pythonhosted.org\n</code></pre> <p>Det finnes en offisiell oracle adapter for dbt v1.x. Gjerne start med \u00e5 ta en titt p\u00e5 denne installasjonsguiden f\u00f8rst.</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#installasjon","title":"Installasjon","text":"<p>dbt kan installeres sammen med oracle adapteren med kommandoen:</p> <pre><code>pip install dbt-oracle\n</code></pre> <p>Nedlasting feiler</p> <pre><code>$ pip install dbt-oracle\nWARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)'))': /simple/dbt-oracle/\n\n...\n\nCould not fetch URL https://pypi.org/simple/dbt-oracle/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/dbt-oracle/ (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)')))\n</code></pre> <p>Sjekk om du har gjort oppsett av sertifikater til pip.</p> <p>Installasjon feiler</p> <p>I noen tilfeller har vi opplevd at Microsoft Visual C++ mangler. Feilmeldingen kan se slik ut:</p> <p><pre><code>...\nBuilding wheels for collected packages: cx-Oracle\nBuilding wheel for cx-Oracle (pyproject.toml) ... error\nerror: subprocess-exited-with-error\n\n\u00d7 Building wheel for cx-Oracle (pyproject.toml) did not run successfully.\n\u2502 exit code: 1\n\u2570\u2500&gt; [8 lines of output]\n      C:\\Users\\RA_S167159\\AppData\\Local\\Temp\\pip-build-env-lh09agh5\\overlay\\Lib\\site-packages\\setuptools\\config\\expand.py:144: UserWarning: File 'C:\\\\Users\\\\RA_S167159\\\\AppData\\\\Local\\\\Temp\\\\pip-install-ki6mcccg\\\\cx-oracle_5a1e160a6cb5498187fe05d5b5637d8c\\\\README.md' cannot be found\n        warnings.warn(f\"File {path!r} cannot be found\")\n    pip_system_certs: ERROR: could not register module: No module named 'wrapt'\n    running bdist_wheel\n    running build\n    running build_ext\n    building 'cx_Oracle' extension\n    error: Microsoft Visual C++ 14.0 or greater is required. Get it with \"Microsoft C++ Build Tools\": https://visualstudio.microsoft.com/visual-cpp-build-tools/\n    [end of output]\n\nnote: This error originates from a subprocess, and is likely not a problem with pip.\nERROR: Failed building wheel for cx-Oracle\nFailed to build cx-Oracle\nERROR: Could not build wheels for cx-Oracle, which is required to install pyproject.toml-based projects\n...\n</code></pre> Last ned og installer Build Tools. F\u00f8lg gjerne guiden her: Fixed: Microsoft Visual C++ 14.0 Is Required Error Husk \u00e5 restarte VDI etter installasjon.</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#opprette-nytt-dbt-prosjekt-for-oracle-fra-scratc","title":"Opprette nytt dbt prosjekt for Oracle fra scratc","text":"<p>Hvis du ikke \u00f8nsker \u00e5 ta i bruk standardprosjektet, men heller kj\u00f8re <code>dbt init</code> er det noen ting som kan skape uforst\u00e5elige feilmeldinger:</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#quoting","title":"Quoting","text":"<p>Quoting av databasenavn m\u00e5 aktiveres i <code>dbt_project.yml</code> siden databasenenavnene til dvh-databasene er med sm\u00e5 bokstaver (eks. dwhu1). Hvis ikke dette gj\u00f8res kommer det feilmeling som sier noe slikt som <code>approximate match</code></p> <p>For \u00e5 skru p\u00e5 quoting m\u00e5 f\u00f8lgende settes i <code>dbt_project.yml</code>:</p> <pre><code>quoting:\n  database: true\n</code></pre>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#hemmeligheter-ved-kjring-fra-utviklerimage","title":"Hemmeligheter ved kj\u00f8ring fra utviklerimage","text":"<p>Av sikkerhetshensyn anbefaler vi og oracle \u00e5 bruke milj\u00f8variabler for \u00e5 holde p\u00e5 hemmeligheter. Vi har derfor laget et script og profiles.yml som kan ligge i dbt-prosjektet.</p> <p>Scriptet kan lastes ned fra navikt/dvh_template/dbt/setup_db_user.ps1.</p> <p><code>profiles.yml</code> skal opprettes i p\u00e5 toppniv\u00e5 i dbt-prosjektmappen, eksempel navikt/dvh_template/dbt/profiles.yml Merk at navn p\u00e5 profil er profilnavnet det henvises til i  <code>dbt_project.yml</code></p> <pre><code>&lt;navn p\u00e5 profil&gt;:\n  target: \"{{env_var('DBT_DB_TARGET')}}\"\n ...\n</code></pre> <p>N\u00e5r profilen er p\u00e5 plass i prosjektmappen kan du teste at dbt fungerer.</p>"},{"location":"Installasjon-p%C3%A5-VDI/dbt/#teste-dbt-installasjonen","title":"Teste dbt installasjonen","text":"<p>Etter at dbt er p\u00e5 plass kan du verifisere at dbt fungerer ved \u00e5 kj\u00f8re <code>.\\setup_db_user.ps1</code> etterfulgt av <code>dbt debug</code> fra prosjektmappen. Er det et nytt prosjekt m\u00e5 du opprette profiles.yml f\u00f8rst.</p> <p><code>.\\setup_db_user.ps1</code> m\u00e5 kj\u00f8res hver gang en starter en ny terminal eller \u00f8nsker \u00e5 bytte target (db). Scriptet vill midlertidlig opprette milj\u00f8variablene i terminal-sesjonen for target, brukernavn, passord, schema og peke dbt mot profiles.yml i prosjektmappen.</p> <p>Success</p> <pre><code>$ .\\setup_db_user.ps1\nTarget db: U &lt;eventuelt Q,R eller P&gt;\nSchema:\n\ncmdlet Get-Credential at command pipeline position 1\nSupply values for the following parameters:\nCredential\n\n$ dbt debug\n09:15:08  Running with dbt=1.1.1\ndbt version: 1.1.1\npython version: 3.8.10\npython path: c:\\users\\****\\appdata\\local\\programs\\python\\python38\\python.exe\nos info: Windows-10-10.0.19044-SP0\nUsing profiles.yml file at C:\\Users\\****\\git\\dvh-sykefravar-dmx\\profiles.yml\nUsing dbt_project.yml file at C:\\Users\\****\\git\\dvh-sykefravar-dmx\\dbt_project.yml\n\n09:15:08  oracle adapter: Running in cx mode\nConfiguration:\n  profiles.yml file [OK found and valid]\n  dbt_project.yml file [OK found and valid]\n\nRequired dependencies:\n- git [OK found]\n\nConnection:\n  user: ****\n  database: dwhu1\n  schema: ****\n  protocol: tcp\n  host: dm07-scan.adeo.no\n  port: 1521\n  tns_name: None\n  service: dwhu1\n  connection_string: None\n  shardingkey: []\n  supershardingkey: []\n  cclass: None\n  purity: None\n  Connection test: [OK connection ok]\n\nAll checks passed!\n</code></pre> <p>DBT er n\u00e5 klart til bruk.</p> <p>Error</p> <pre><code>Connection test: [ERROR]\n\n2 checks failed:\nError from git --help: Could not find command, ensure it is in the user's PATH and that the user has permissions to run it: \"git\"\n\ndbt was unable to connect to the specified database.\nThe database returned the following error:\n\n  &gt;Database Error\n  DPI-1047: Cannot locate a 64-bit Oracle Client library: \"failed to get message for Windows Error 126\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help\n\nCheck your database credentials and try again. For more information, visit:\nhttps://docs.getdbt.com/docs/configure-your-profile\n</code></pre> <p>Oracle client library er mest sannsynlig ikke installert.</p>"},{"location":"Installasjon-p%C3%A5-VDI/git/","title":"Git","text":"<p>F\u00f8lg guiden p\u00e5 confluence og legg til milj\u00f8variabler der det kreves. Pass p\u00e5 \u00e5 f\u00f8lge denne guiden til punkt og prikke. Mange problemer har kommet av at noen punkter her er avglemt.</p>"},{"location":"Installasjon-p%C3%A5-VDI/installere/","title":"Installere dbt-oracle p\u00e5 VDI","text":""},{"location":"Installasjon-p%C3%A5-VDI/installere/#forutsetninger","title":"Forutsetninger","text":"<p>For \u00e5 kunne utvikle dbt mot oracle m\u00e5 man ha tilgang til utviklerimage som er et VDI som kj\u00f8rer i i NAV datahall. Dette er for \u00e5 kunne f\u00e5 kontakt med Oracle databaser. Du m\u00e5 ogs\u00e5 har f\u00e5tt en eller felere databasebrukere og det er nyttig \u00e5 kunne koble seg opp mot databasene med SQL Developer. Se f\u00f8lgende lenker:</p> <ul> <li>Utviklerimage</li> <li>SQL Developer med databasebruker</li> </ul>"},{"location":"Installasjon-p%C3%A5-VDI/installere/#installasjon-av-dbt-oracle","title":"Installasjon av dbt-oracle","text":"<p>For \u00e5 installere dbt-core for Oracle m\u00e5 du installere f\u00f8lgende:</p> <ol> <li>Python 3.11.x</li> <li>PIP og oppsett av dbt-milj\u00f8</li> <li>Git / GitHub Desktop</li> <li>dbt</li> </ol>"},{"location":"Installasjon-p%C3%A5-VDI/installere/#anbefalinger","title":"Anbefalinger","text":"<p>For en god utvikleropplevelse anbefaler vi deg \u00e5 ha f\u00f8lgende installert:</p> <ul> <li>Visual studio code eller en annen tekst editor<ul> <li>dbt Power User En sv\u00e6rt nyttig VS Code extension</li> </ul> </li> <li>SQLFluff</li> </ul>"},{"location":"Installasjon-p%C3%A5-VDI/miljovariabler/","title":"Legge til milj\u00f8variabler","text":"<ol> <li>S\u00f8k etter <code>milj\u00f8variabler</code></li> <li>Klikk p\u00e5: <code>Rediger milj\u00f8bariabler for kontoen din</code></li> </ol> <ol> <li>Trykk p\u00e5 <code>Ny...</code></li> <li>Gi variabelen et navn i <code>Variabelnavn</code>.</li> <li>Skriv inn path til programmet i <code>Variabelverdi</code></li> <li>Trykk <code>OK</code></li> </ol> <ol> <li>Marker <code>Path</code> variabelen</li> <li>Trykk <code>Rediger...</code></li> </ol> <ol> <li>Trykk <code>Ny</code></li> <li>Skriv inn navnet p\u00e5 variabelen du opprettet med syntaksen <code>%&lt;variabelnavn&gt;%</code> eks: <code>%PIP%</code></li> <li>Trykk <code>OK</code></li> </ol> <ol> <li>Trykk <code>OK</code></li> </ol> <p>Note</p> <p>Husk at du m\u00e5 lukke <code>cmd</code> (ledetekst) og \u00e5pne p\u00e5 nytt for at endringen skal tre i kraft.</p>"},{"location":"Installasjon-p%C3%A5-VDI/oracle-client-library/","title":"Oracle client library","text":"<p>Note</p> <p>Dette steget utg\u00e5r hvis du bruker thin mode (tynnklient som ikke trenger klientbiblioteket. Introdusert i dbt-oracle 1.1.1). Det anbefales \u00e5 bruke thin mode, da kj\u00f8ring av kode g\u00e5r en del raskere.</p> <p>Dette finnes p\u00e5 fellesdisken og mappen programvare\\oracle\\ og kan kopieres lokalt. Det er er instantclient-basiclite-windows som benyttes.</p> <p>Oppdater <code>PATH</code> milj\u00f8variabelen med path til oracle client library. Eksmpel:</p> <pre><code>C:\\data\\instantclient-basiclite-windows\\instantclient_19_11\n</code></pre> <p>Note</p> <p>Se legg til milj\u00f8variabler hvis du ikke vet hvordan du oppdatere PATH.</p>"},{"location":"Installasjon-p%C3%A5-VDI/pip-og-oppsett/","title":"PIP og og tilgang til PyPI","text":"<pre><code>pip --version\n</code></pre>"},{"location":"Installasjon-p%C3%A5-VDI/pip-og-oppsett/#feilsk-sjekk-om-du-har-pip","title":"Feils\u00f8k: Sjekk om du har PIP","text":"<p>Har du installert python, s\u00e5 har du nesten sikkert ogs\u00e5 pip. Men dersom overst\u00e5ende feiler, kj\u00f8r <code>pip --version</code> for \u00e5 se om pip er tilgjengelig:</p> <pre><code>pip --version\n</code></pre> <p>Success</p> <pre><code>pip --version\n\npip 21.1.1 from c:\\users\\*****\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\\pip (python 3.8)\n</code></pre> <p>Fortsett til Git / GitHub Desktop</p> <p>Failure</p> <pre><code>pip --version\n\n'pip' is not recognized as an internal or external command, operable program or batch file.\n</code></pre> <p>Kj\u00f8r <code>py -3 -m ensurepip</code> for \u00e5 se om pip allerede eksisterer.</p> <pre><code>Looking in links: c:\\Users\\****\\AppData\\Local\\Temp\\tmp4r6s0n91\nRequirement already satisfied: setuptools in c:\\users\\****\\appdata\\local\\programs\\python\\pythonXX\\lib\\site-packages (58.1.0)\nRequirement already satisfied: pip in c:\\users\\****\\appdata\\local\\programs\\python\\pythonXX\\lib\\site-packages (21.2.4)\n</code></pre> <p>I dette tilfelle m\u00e5 milj\u00f8variabelen <code>PATH</code> oppdateres. Bruk gjerne <code>Fil utforsker</code> for \u00e5 finne riktig path men normalt ligger PIP under:</p> <pre><code>c:\\users\\&lt;brukernavn&gt;\\appdata\\local\\programs\\python\\pythonXX\\scripts\n</code></pre> <p>Info</p> <p>Se legg til milj\u00f8variabler hvis du ikke vet hvordan du oppdatere <code>PATH</code>.</p> <p>Husk at du m\u00e5 lukke og \u00e5pne cmd (ledetekst) etter path variabel er lagt inn. Du kan n\u00e5 verifisere at pip er tilgjengelig ved \u00e5 kj\u00f8re <code>pip --version</code>.</p>"},{"location":"Installasjon-p%C3%A5-VDI/python/","title":"Python","text":"<p>Sjekk om Python er installert med <code>py --version</code>. dbt-versjon 1.4 og senere st\u00f8tter Python-versjon 3.11, for en tidligere dbt-versjon m\u00e5 Python-versjon v\u00e6re &gt;= 3.8 og &lt; 3.11.</p> <p>Last eventuelt ned python 3.11.x og installer ved \u00e5 f\u00f8lge installsjonsveiviseren.</p> <p>G\u00e5 til Windows \"Ledetekst\"/\"Command prompt\" og skriv f\u00f8lgende.</p> <pre><code>py --version\n</code></pre> <p>Hvis py ikke fungerer, kan det hende at det heter python:</p> <pre><code>python --version\n</code></pre> <p>Success</p> <pre><code>$ py --version\n\nPython 3.8.10\n</code></pre> <p>Fortsett til PIP</p> <p>Failure</p> <p><pre><code>$ py --version\n\nPython 3.6.4\n</code></pre> For gammel version av Python</p> <p>Last ned Python</p> <p>Failure</p> <pre><code>$ py --version\n\npython is not recognized as an internal or external command, operable program, or batch file\n</code></pre> <p>Python er ikke installert</p> <p>Last ned Python</p>"},{"location":"Installasjon-p%C3%A5-VDI/sqlfluff/","title":"SQLFluff","text":"<p>SQLFluff er en linter som hjelper oss med \u00e5 formattere SQL-koden p\u00e5 en fornuftig m\u00e5te.</p>"},{"location":"Installasjon-p%C3%A5-VDI/sqlfluff/#installering-av-sqlfluff","title":"Installering av SQLFluff","text":"<pre><code>pip install sqlfluff sqlfluff-templater-dbt\n</code></pre>"},{"location":"Installasjon-p%C3%A5-VDI/vscode/","title":"Visual Studio Code","text":"<p>Bruk https://code.visualstudio.com/download, velg Windows versjonen. Last ned, pakk ut og start programmet code. F\u00f8lg instruksjonene ved innstalleringen.</p>"},{"location":"Installasjon-p%C3%A5-VDI/vscode/#anbefalte-extensions","title":"Anbefalte extensions","text":"<ul> <li>dbt Power User En sv\u00e6rt nyttig VS Code extension, anbefales sterkt!</li> <li>SQLFluff</li> </ul>"},{"location":"arkitektur/materialisering/","title":"Materialiseringsstrategier","text":"<p>Hva er materialiseringer i dbt?. dbt-oracle st\u00f8tter alle former for materialisering.</p> <p>Generelt er det en god ide \u00e5 f\u00f8lge Best practices for materializations fra dbt labs.</p> <p>Det er likevel noen avvik:</p> <ol> <li>Staging modeller b\u00f8r hovedsakelig v\u00e6re views.<ul> <li>Men pseduonymisering skal skje s\u00e5 tidlig som mulig, og derfor er det n\u00f8dvendig at kilder som inneholder personn\u00f8kler blir lastet inkrementelt. Det er ofte et krav om at r\u00e5data blir slettet etter 6 m\u00e5neder.</li> </ul> </li> <li>Intermediate ved kompleks logikk. Kj\u00f8r views n\u00e5r du kan. N\u00e5r views g\u00e5r for tregt, har du tre valg:<ol> <li>Kj\u00f8re table materialiseringer. tabeller blir droppet, purget og rekj\u00f8rt med alt innhold fra sp\u00f8rringen i modellfilen. Ikke lurt ved ved st\u00f8rre mengder data, b\u00e5de ytelsesmessig og lagring i flere lag.</li> <li>Incrememental. Tabellen bevares og nye endrede rader blir lagt til med merge.</li> <li>Delta last med table models ... trenger POC</li> </ol> </li> <li>Marts skal v\u00e6re stabil. Det er her alle sp\u00f8rringer fra konsumenter kj\u00f8res, og det er viktig for basen \u00e5 opparbeide statistikk p\u00e5 sp\u00f8rringer som kj\u00f8rer ofte.<ul> <li>materialized_view er for MVP og sm\u00e5 datamengder, jher er ikke ytelse noe problem.</li> <li>For l\u00f8sninger med st\u00f8rre datamenger, kj\u00f8r inkrementell last med partisjonering og indeksering.</li> </ul> </li> <li>Skal du skrive om en gammel l\u00f8sning til dbt? Ikke skriv om l\u00f8pet og sats p\u00e5 at alt skal blir 100% likt. Du kan ve\u00e6re sikekr p\u00e5 at data (oppslag mot avhengigheter) har endret seg siden forrige gang dataene har blitt kj\u00f8rt opp. Spesielt med tanke p\u00e5 at patching og rekj\u00f8ring med forskjellig logikk har blitt gjort gjennom tidene.<ul> <li>Bruk tidligere target-tabell som kilde til dbt og kj\u00f8r en union all. Ny last b\u00f8r da v\u00e6re inkrementelt over en initlast fra gammel targettabell.</li> </ul> </li> </ol>"},{"location":"arkitektur/materialisering_spenn/","title":"Materialiseringsstrategi i Team Spenn","text":"<p>Form\u00e5let med denne strategien er \u00e5 unng\u00e5 droppe og deretter opprette datavarehusobjekter hver gang et dbt-l\u00f8p kj\u00f8res da dette er ugunstig mhp. DMO. Derfor har <code>table</code>-materialisering blitt faset ut i v\u00e5re prosjekter. F\u00f8lgende materialiseringer blir derfor tatt i bruk p\u00e5 tvers av v\u00e5re dbt-l\u00f8p:</p> Materialisering Kommentar Staging <code>ephemeral</code> Staging-modellene blir materialisert som <code>ephemeral</code> fordi de kun fungerer som simple transformasjoner som ikke skal eksponeres for sluttbrukeren. Det er heller ikke behov for \u00e5 lagre dataene fysisk. Intermediate <code>view</code> Intermediate-modellene blir materialisert som <code>view</code> fordi de har kompleks logikk og kj\u00f8rer ikke for tregt. Marts <code>incremental</code> og <code>view</code> Faktatabeller, som ofte inneholder store datamengder, blir materialisert som <code>incremental</code> for \u00e5 redusere kj\u00f8re- og lagringstiden. Aggregater (b\u00e5de brede og \u00e5pne aggregater som skal deles og konsumeres) blir materialisert som <code>view</code> da de ikke inneholder mye data og mangler unike n\u00f8kler. Hvis aggregatene begynner \u00e5 ta for lang tid \u00e5 kj\u00f8re som <code>view</code>, kan de alternativt materialiseres som <code>incremental</code> (gitt at duplikater ikke er et problem for modellen og/eller at <code>unique_key</code> eksisterer) eller som <code>materialized view</code> (se utfordringer nevnt nedenfor)."},{"location":"arkitektur/materialisering_spenn/#mer-om-var-incremental-materialisering-i-marts","title":"Mer om v\u00e5r incremental-materialisering i Marts","text":"<p>Vi bruker <code>unique_key</code>-konfigurasjonen for \u00e5 finne rader fra en tidligere kj\u00f8ring med samme unike ID. Dette gj\u00f8r det mulig \u00e5 oppdatere eksisterende rader i stedet for \u00e5 legge dem til som nye:</p> <p><pre><code>{{\n  config(\n    materialized = 'incremental',\n    unique_key = ['fk_person1', 'aarmnd'],\n    merge_exclude_columns = ['fk_person1', 'aarmnd', ...],\n    ...\n  )\n}}\n\nselect ...\n</code></pre> For \u00e5 legge til nye rader benytter vi <code>is_incremental()</code>-makroen: <pre><code>select ...\nwhere \n{% if is_incremental() %}\naarmnd &gt; (select max(aarmnd) from {{ this }})\n{% endif %}\n</code></pre></p>"},{"location":"arkitektur/materialisering_spenn/#utfordringer-med-materialized-view","title":"Utfordringer med materialized view","text":"<p>Vi fors\u00f8kte \u00e5 materialisere v\u00e5re aggregater som <code>materialized view</code>, men st\u00f8tte p\u00e5 flere begrensninger:</p> <ol> <li>Modeller som bruker denne materialiseringen krever <code>materialized view log</code> p\u00e5 parent-/master-modeller.</li> <li>Modeller som bruker denne materialiseringen blir automatisk satt til \"forced refresh\" i Oracle - se tabell 5-3 under seksjon 5.3.7 \"About refresh Options for Materialized Views\" for refresh-definisjoner.</li> <li>Det er flere restriksjoner for \"fast refresh\" p\u00e5 <code>materialized view</code>:<ul> <li>5.3.7.4 \"General Restrictions on Fast Refresh\"</li> <li>5.3.7.5 \"Restrictions on Fast Refresh on Materialized Views with Joins Only\"</li> <li>5.3.7.6 \"Restrictions on Fast Refresh on Materialized Views with Aggregates\"</li> </ul> </li> </ol>"},{"location":"arkitektur/style_guide/","title":"DBT Stil Guide","text":"<p>forket fra https://github.com/dbt-labs/corp/blob/main/dbt_style_guide.md</p>"},{"location":"arkitektur/style_guide/#modell-naming","title":"Modell Naming","text":"<p>V\u00e5r modellere organiserers inn i tre hovedgrupper: staging, marts, base/intermediate. See f\u00f8lgnede diskusjon. The navngiving blir som f\u00f8lger: <pre><code>\u251c\u2500\u2500 dbt_project.yml\n\u2514\u2500\u2500 models\n    \u251c\u2500\u2500 marts\n    |   \u2514\u2500\u2500 core\n    |       \u251c\u2500\u2500 mellomlager\n    |       |   \u251c\u2500\u2500 mellomlager.yml\n    |       |   \u251c\u2500\u2500 posteringer__unionisert.sql\n    |       |   \u2514\u2500\u2500 posteringer__gruppert.sql\n    |       \u251c\u2500\u2500 core.docs\n    |       \u251c\u2500\u2500 dim_artskonti\n    |           \u251c\u2500\u2500 dim_artskonti.yml\n    |           \u2514\u2500\u2500 dim_artskonti.sql\n    |       \u251c\u2500\u2500 dim_konstnadssteder\n    |           \u251c\u2500\u2500 dim_konstnadssteder.yml\n    |           \u2514\u2500\u2500 dim_konstnadssteder.sql\n    |       \u2514\u2500\u2500 fak_hovedbok_posteringer\n    |           \u251c\u2500\u2500 fak_hovedbok_posteringer.yml\n    |           \u2514\u2500\u2500 fak_hovedbok_posteringer.sql\n    \u2514\u2500\u2500 staging\n        \u2514\u2500\u2500 oebs\n            \u251c\u2500\u2500 base\n            |   \u251c\u2500\u2500 base.yml\n            |   \u2514\u2500\u2500 base__oebs_kontoplan.sql\n            \u251c\u2500\u2500 src_oebs.yml\n            \u251c\u2500\u2500 src_oebs.docs\n            \u251c\u2500\u2500 stg_oebs__posteringerslinjer\n            |   \u251c\u2500\u2500 stg_oebs__posteringerslinjer.yml\n            |   \u2514\u2500\u2500 stg_oebs__posteringerslinjer.sql\n            \u251c\u2500\u2500 stg_oebs__budjsett_balanser\n            |   \u251c\u2500\u2500 stg_oebs__budjsett_balanser.yml\n            |   \u2514\u2500\u2500 stg_oebs__budjsett_balanser.sql\n</code></pre> - All objekter oppgis p\u00e5 flertallsform, slik som: <code>stg_oebs__hovedbok_posteringslinjer</code>, <code>stg_oebs__artskonti</code>, etc. - Basetabeller prefikses med <code>base__</code>, slik som: <code>base__&lt;source&gt;_&lt;object&gt;</code> - Mellomlagringstabeller skal avsluttes med et fortidsverb som indikerer hvilken handling som er gjort p\u00e5 objektet, slik som: <code>hovedbok_posteringslinjer__filtrert_budsjett</code> - Datatorg, eller marter, er fordelt mellom faktaer (uforandelig, verb) og dimensjoner (foranderlig, subjekt) og prefikses med <code>fak_</code> og <code>dim_</code>, henholdvis.  - Staged strukter inneholder alle kolonner fra r\u00e5-tabellen og utvides med avledede kolonner, for \u00e5 angi naturlig n\u00f8kler, hashed n\u00f8kler, omd\u00f8ping av kolonnenavn, etc. </p>"},{"location":"arkitektur/style_guide/#model-konfigurasjon","title":"Model konfigurasjon","text":"<ul> <li>Model-spesifike attributer (som sort/dist keys) skal spesifiseres i modellen.</li> <li>Hvis en spesifikk konfigurasjon som gjelder alle modeller i en folder, burde dette spesifiseres i <code>dbt_project.yml</code>.</li> <li>Modell konfigurationer skal spesifiseres slik:</li> </ul> <p><pre><code>{{\n  config(\n    materialized = 'table',\n    sort = 'id',\n    dist = 'id'\n  )\n}}\n</code></pre> - Marter b\u00f8r alltid configureres som tabeller - med mindre det er sv\u00e6rt gode grunner til \u00e5 ikke gj\u00f8re det. </p>"},{"location":"arkitektur/style_guide/#dbt-konvensjoner","title":"DBT konvensjoner","text":"<ul> <li>Kun <code>stg_</code>og <code>base_</code> sp\u00f8r mot <code>source</code>er.</li> <li>Alle andre <code>ref</code> andre modeller.</li> </ul>"},{"location":"arkitektur/style_guide/#tester","title":"Tester","text":"<ul> <li>Hver underfolder inneholder en <code>.yml</code> fil som tester alle modeller i folderen. Navnestandarden skal v\u00e6re <code>&lt;folder-navn&gt;.yml</code>. </li> <li>Som et minimum, skal <code>unique</code> og <code>not_null</code> v\u00e6re testet p\u00e5 prim\u00e6r n\u00f8kkeler</li> </ul>"},{"location":"arkitektur/style_guide/#navngivining-og-felt-konvensjoner","title":"Navngivining og felt konvensjoner","text":"<ul> <li>Skjema, tabell og kolonne nanv skal v\u00e6re <code>snake_case</code>.</li> <li>Bruk navn basert p\u00e5 business terminologien, i stedet for kilde terminology.</li> <li>Hver model skal ha en prim\u00e6r n\u00f8kkel.</li> <li>Prim\u00e6r n\u00f8kkeler i modellen navngis som <code>pk_&lt;objekt&gt;</code>, alts\u00e5 <code>pk_dim_person</code>. </li> <li>Fremmed n\u00f8kkeler angis som <code>fk_&lt;objekt&gt;</code>, tidsl\u00f8se enhets n\u00f8kkeler angis som <code>ek_&lt;objekt&gt;</code> og naturlige n\u00f8kkeler angis som <code>lk_&lt;objekt&gt;</code>. </li> <li>For base og stage modeller skal felter v\u00e6re ordnet inne kategorier, fra identifikatorer til tidsstempler tilslutt. </li> <li>Tidsstempel kolonner skal v\u00e6ver navngitt som <code>&lt;hendelse&gt;_ts</code>, e.g. <code>lastet_ts</code>, og skal v\u00e6re p\u00e5 UTC. for avvikende tidszoner skal tidzonen indikeres ved suffiks, e.g <code>lastet_ts_pt</code>.</li> <li>Boolean verdier og skal oppgis mot <code>er_</code> eller <code>har_</code> og uttrykkes med 1 for <code>Ja</code> og 0 for <code>Nei</code>.</li> <li>Bel\u00f8ps kolonner skal ha suffiks <code>_nok</code>for, flyttalls, bel\u00f8p i kroner, og <code>_orer</code> for heltall bel\u00f8p i \u00f8rer.</li> <li>S\u00e6r norske bokstaver som \u00c6, \u00d8, \u00c5 skal angis som <code>ae</code>, <code>o</code> og <code>a</code>.</li> <li>Unng\u00e5r reservert word som kolonne navn. </li> <li>Bruk samme feltnavn gjennom alle modellene hvor mulig, e.g. n\u00f8kkelen til <code>dim_person</code> skal v\u00e6re <code>pk_dim_person</code>og ikke <code>pk_bruker</code>.</li> </ul>"},{"location":"arkitektur/style_guide/#cteer","title":"CTEer","text":"<p>For mer informasjon om hvorfor vi bruker CTEer, see f\u00f8lgende post. Kortversjonen er at det hjelper oss \u00e5 samle kildene \u00f8verst, gj\u00f8re enkle transformasjoner og joiner i midten og se resultatet nederst. Oracle skal st\u00f8tte passthrough slik at masse wither p\u00e5 rad ikke p\u00e5virker ytelsen.</p> <ul> <li>Alle <code>{{ ref('...') }}</code> settning skal plasseres i en egen CTE, ved toppen av fila. </li> <li>Hvor det er mulig, skal en CTE gj\u00f8re en og kun en logisk mengde arbeid. </li> <li>CTE navn skal v\u00e6re ordrike og beskrive hva denne faktisk gj\u00f8r. </li> <li>CTE er med forvirrende eller avansert logik skal kommenteres like etter at den er definert.  <pre><code>with\n\nhendelser_vask as (\n\n    -- Kommentarer\n    -- mer kommentarer\n    ...\n)\n</code></pre> ),</li> <li>CTEer som gjenbrukes i feller modeller skal tas ut og bli egne modeller. </li> <li>Modeller b\u00f8r avsluttest med en  <code>endelig</code> CTE som selekterer hele det endelig produktet f\u00f8r modelen avslutted <code>SELECT * FROM endelig</code>. </li> <li>CTEene skal formatere som f\u00f8lger:</li> </ul> <pre><code>WITH\n\nhendelser AS (\n\n    ...\n\n),\n\n-- CTE comments go here\nfiltrerte_hendelser AS (\n\n    ...\n\n),\n\nendelig AS (\n\n    SELECT * FROM filtrerte_hendelser\n\n),\n\n\nSELECT * FROM endelig\n</code></pre>"},{"location":"arkitektur/style_guide/#sql-stil-guide","title":"SQL stil guide","text":"<ul> <li>Sett komma p\u00e5 slutten setningen</li> <li>Bruke fire mellom rom for \u00e5 indentere koden, uten om ved predikatet, som skal v\u00e6re p\u00e5 linje med <code>WHERE</code></li> <li>Ingen linjer skal v\u00e6re lenger enn 80 tegn</li> <li>All felt navn skal v\u00e6re skrevet med sm\u00e5 bokstaver, og alle funksjonsnavn (<code>SELECT</code>, <code>WHERE</code>, <code>LEAD</code>, etc.) med STORE. </li> <li>Bruk alltid <code>AS</code>for \u00e5 aliase tabeller og felt. </li> <li>Alle felt skal angis f\u00f8r alle aggregater og vindu funskjoner. </li> <li>Aggregering skal skal l\u00f8ses s\u00e5 tidlig som mulig, f\u00f8r en joiner med andre tabeller. </li> <li><code>ORDER BY</code>og <code>GROUP BY</code> skal v\u00e6r angitt med nummer i stedet for kolonne navn (se f\u00f8lgende for why). Gruppering b\u00f8r gj\u00f8res p\u00e5 kun noen f\u00e5 kolonne verdier. </li> <li>Bruk helst <code>UNION ALL</code> fremfor <code>UNION</code> *</li> <li>Unng\u00e5 bruk tabell alias i <code>JOIN</code> criterer. Det er ofte vanskelig \u00e5 forst\u00e5 hvor tabellen \"c\" kommer fra.</li> <li>Hvis en joiner to eller flere tabeller, alltid prefiks kolonenne med et table alias. Hvis en selekterer fra kun en tabell trengs ingen prefiks. </li> <li>Skriv eksplisite joins, alts\u00e5 skriv <code>INNER JOIN</code> instead of <code>JOIN</code>). </li> <li> <p>Bruk <code>LEFT JOIN</code> fremfor <code>RIGHT JOIN</code> </p> </li> <li> <p>Ikke optimaliserer for f\u00e5 linjer kode. Nye linjer er billig, hjerner er dyre</p> </li> </ul>"},{"location":"arkitektur/style_guide/#eksempel-sql","title":"Eksempel SQL","text":"<pre><code>WITH\n\nmin_data AS (\n\n    SELECT * FROM {{ ref('min_data') }}\n\n),\n\nen_cte AS (\n\n    SELECT * FROM {{ ref('en_cte') }}\n\n),\n\nen_cte_agg AS (\n\n    SELECT\n        id,\n        SUM(felt_4) AS total_felt_4,\n        MAX(felt_5) AS max_felt_5\n\n    FROM en_cte\n    GROUP BY 1\n\n),\n\nendelig AS (\n\n    SELECT [DISITNCT]\n        min_data.felt_1,\n        min_data.felt_2,\n        min_data.felt_3,\n\n        -- Bruk linjeshift for visuelt separere kalkulasjoner inn i blokker.\n        CASE\n            WHEN min_data.kansellerings_dato IS NULL\n                AND min_data.utgangs_dato is not null\n                THEN utgangsdato_date\n            WHEN my_data.kansellerings_dato IS NULL\n                THEN my_data.start_dato + 7\n            ELSE my_data.kansellerings_date\n        END AS kansellerings_dato,\n\n        en_cte_agg.total_felt_4,\n        en_cte_agg.max_felt_5\n\n    FROM min_data\n    LEFT JOIN en_cte_agg  \n        ON min_data.id = en_cte_agg.id\n    WHERE min_data.felt_1 = 'abc'\n        AND (\n            min_data.felt_2 = 'def' OR\n            min_data.felt_2 = 'ghi'\n        )\n    HAVING COUNT(*) &gt; 1\n\n)\n\nSELECT * FROM final\n</code></pre> <ul> <li>Bruk <code>LEFT JOIN</code> fremfor <code>RIGHT JOIN</code>: <pre><code>SELECT\n    reiser.*,\n    sjaforer.rating AS driver_rating,\n    passasjerer.rating AS rider_rating\n\nFROM resier\nLEFT JOIN personer AS sjaforer\n    ON reiser.fk_personer_sjaforer = sjaforer.pk_personer\nLEFT JOIN personer AS passasjerer\n    ON reiser.fk_personer_passasjerer = sjaforer.pk_personer\n</code></pre></li> </ul>"},{"location":"arkitektur/style_guide/#yaml-stil-guide","title":"YAML stil guide","text":"<ul> <li>Setning indenteres med to mellomrom </li> <li>Lister skal v\u00e6re indentert </li> <li>Bruk linjeskift for \u00e5 separere lister n\u00e5r n\u00f8dvendig. </li> <li>Linjer skal ikke v\u00e6re lenger en 80 karakterer </li> </ul>"},{"location":"arkitektur/style_guide/#eksample-yaml","title":"Eksample YAML","text":"<pre><code>version: 2\n\nmodels:\n  - name: hendelser\n    columns:\n      - name: pk_hendelser\n        description: Dette er n prim\u00e6rn\u00f8kkel\n        tests:\n          - unique\n          - not_null\n\n      - name: hendelse_ts \n        description: \"N\u00e5r hendelse skjedde i UTC (eg. 2018-01-01 12:00:00)\"\n        tests:\n          - not_null\n\n      - name: fk_brukere\n        description: Brukeren som st\u00e5 for hendelsen \n        tests:\n          - not_null\n          - relationships:\n              to: ref('brukere')\n              field: pk_brukere\n</code></pre>"},{"location":"arkitektur/style_guide/#jinja-stil-guide","title":"Jinja stil guide","text":"<ul> <li>Ved inklusjon av Jinja kode bruk mellomrom p\u00e5 iden av klammene <code>{{ slik }}</code> istedefor <code>{{slik}}</code></li> <li>Bruk ny linje for \u00e5 dele opp logik i Jinja blokker</li> </ul>"},{"location":"arkitektur/style_guide/#farger-i-lineage","title":"Farger i lineage","text":"<p>I lineagen f\u00e5r source-blobber en lys gr\u00f8nn farge, mens alt annet blir lys bl\u00e5. I <code>.yml</code>-filene kan dette endres med <code>node_color</code>-attributten under <code>+docs</code> til en modell eller en mappe. For \u00e5 skille enklere mellom staging, intermediate og marts har vi valgt f\u00f8lgende som en standard, men dette kan du endre som du vil:</p> <pre><code># i dbt_project.yml\nmodels:\n  ...\n    staging:\n      +docs:\n        node_color: '#054710' # m\u00f8rk gr\u00f8nn farge\n\n    intermediate:\n      +docs:\n        node_color: '#0E4870' # m\u00f8rk bl\u00e5 farge\n\n    marts: # standard dbt-lysebl\u00e5-farge\n    ...\n</code></pre> <p><code>node_color</code>-attributten st\u00f8tter b\u00e5de fargenavn (<code>red</code>) og hex-koder med anf\u00f8rselstegn (<code>\"#cd7f32\"</code>). Se https://docs.getdbt.com/reference/resource-configs/docs for mer informasjon.</p>"},{"location":"dokumentasjon/","title":"Dokumentajson","text":"<p>Dokumentasjon for produkter finner du p\u00e5 DBT Docs by nada</p>"},{"location":"dokumentasjon/dokumentasjon/","title":"Dokumentasjon","text":""},{"location":"dokumentasjon/dokumentasjon/#tabelldokumentasjon","title":"Tabelldokumentasjon","text":"<p>Tabellene konfigureres og dokumenteres i <code>yml</code> filene i hver mappe i prosjektet. Kommentarer kan settes p\u00e5 b\u00e5de tabellniv\u00e5 og kolonneniv\u00e5. Les mer her.</p>"},{"location":"dokumentasjon/dokumentasjon/#persist-docs","title":"Persist docs","text":"<p>dbt-oracle har st\u00f8tte for \u00e5 skrive kommentarer til databasen. Som andre konfig,  kan det settes p\u00e5 prosjektniv\u00e5, mappeniv\u00e5 eller modellniv\u00e5. For \u00e5 sette det p\u00e5 prosjektniv\u00e5, legg til f\u00f8lgende i <code>dbt_project.yml</code> <pre><code>models:\n  +persist_docs:\n    relation: true\n    columns: true\n</code></pre></p> <p>En ting \u00e5 v\u00e6re oppmerksom p\u00e5 n\u00e5r <code>persist_docs</code> er aktivert er at kolonnenavn i modellen m\u00e5 v\u00e6re det samme som definert i yml filen.</p> <p>ORA-00904</p> <pre><code>ORA-00904: \"KOLONNE\": invalid identifier\n</code></pre> <pre><code>SELECT\n  kolonne\nFROM ...\n</code></pre> <pre><code>- name: kolonne_navn\n  description: ...\n</code></pre> <p>Her har Oracle fors\u00f8kt \u00e5 skrive kommentar til en kolonne som ikke eksisterer. Sammenlign modell og yml fil og sjekk at navnet p\u00e5 kolonnen er lik.</p>"},{"location":"dokumentasjon/dokumentasjon/#overskrive-overview","title":"Overskrive overview","text":"<p>Komponentdokumentasjonen kan integreres i dbt dokumentasjonen. I <code>dbt/models</code> folderen m\u00e5 det opprettes en <code>overview.md</code> fil. Bruk gjerne overview.md som mal</p>"},{"location":"dokumentasjon/dokumentasjon/#deployere-dokumentasjon","title":"Deployere dokumentasjon","text":"<p>Hver gang kommandoen dbt docs kj\u00f8res, genereres det tre filer i <code>target</code> mappa under dbt prosjektmappa: <code>index.hml</code>, <code>catalog.json</code> og <code>manifest.json</code>. Disse filene er statiske og inneholder alt som trengs for \u00e5 publisere en versjon av dokumentasjonen p\u00e5 en webserver.</p> <p>Github pages har slik st\u00f8tte. Publsiering til github pages kan gj\u00f8res p\u00e5 flere m\u00e5ter, men kanskje enklest er det \u00e5 bruke en github action:</p> <pre><code># Simple workflow for dbt docs content to GitHub Pages\nname: Deploy dbt docs to GitHub Pages\n\non:\n  push:\n    branches: [\"master\"]\n    paths:\n      - docs/**\n\n  workflow_dispatch:\n\n\npermissions:\n  contents: read\n  pages: write\n  id-token: write\n\n# Allow one concurrent deployment\nconcurrency:\n  group: \"pages\"\n  cancel-in-progress: true\n\njobs:\n  deploy:\n    environment:\n      name: github-pages\n      url: ${{ steps.deployment.outputs.page_url }}\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n      - name: Setup Pages\n        uses: actions/configure-pages@v2\n      - name: Upload artifact\n        uses: actions/upload-pages-artifact@v1\n        with:\n          path: 'docs'\n      - name: Deploy to GitHub Pages\n        id: deployment\n        uses: actions/deploy-pages@v1\n</code></pre> <ol> <li>Importer overst\u00e5ende github action i .workflow</li> <li>Kj\u00f8r kommandoen <code>dbt docs generate</code></li> <li>Lag en docs mappe p\u00e5 roten av repoet, hvis det ikke allerede finnes.</li> <li>Kopier over filene <code>index.hml</code>, <code>catalog.json</code> og <code>manifest.json</code> fra target mappen til docs mappen.</li> <li>Commit og push til main branchen.</li> <li>Docen blir automatisk publisert av github action, til url spesifisert av jobben.</li> </ol>"},{"location":"dokumentasjon/overview/","title":"Overview","text":"<p>{% docs overview %}</p>"},{"location":"dokumentasjon/overview/#xxx-komponenten","title":"XXX - komponenten","text":""},{"location":"dokumentasjon/overview/#formal","title":"Form\u00e5l","text":"<p>Overordnet beskrivelse av form\u00e5l med l\u00f8sningen</p>"},{"location":"dokumentasjon/overview/#komponentbeskrivelse","title":"Komponentbeskrivelse","text":"<ul> <li>Form\u00e5l: </li> <li>Prinsipper:</li> <li>Kilde(r):</li> <li>Brukere:</li> <li>Noe annet:</li> </ul>"},{"location":"dokumentasjon/overview/#struktur-pa-repo","title":"Struktur p\u00e5 repo","text":"<p>Lenke til dokumentasjon p\u00e5 confluence</p> <p>Vi har f\u00f8lgende mapper: - db (medf\u00f8lgende readme)   - install (her ligger ddl filer per tabell/view. Ogs\u00e5 dcl-filer som gir grants)   - patch (hvert script har jira-kode som prefiks og kort forklaring/tabellnavn). N\u00e5r man endrer en tabell her m\u00e5 man ogs\u00e5 endre den i install-filen)   - utils (kanskje, hvis man trenger det) - dbt - dbt prosjektet. dette er stien der man kj\u00f8rer dbt kommandoer.</p>"},{"location":"dokumentasjon/overview/#overordnet-design","title":"Overordnet design","text":""},{"location":"dokumentasjon/overview/#dataflyt-diagram","title":"Dataflyt-diagram","text":"<p>Dataflyten finnes ved \u00e5 klikke p\u00e5 det bl\u00e5 ikonet nederst til h\u00f8yre p\u00e5 siden </p> # DAG task kilde m\u00e5l kommentar"},{"location":"dokumentasjon/overview/#databasebeskrivelse","title":"Databasebeskrivelse","text":"<p>En oversikt over de viktigste tabellene</p> Tabell/Views Beskrivelse tabell1 besk tabell2 besk"},{"location":"dokumentasjon/overview/#databasescript","title":"Databasescript","text":"<p>Referanser til hvor databasescriptene befinner seg</p>"},{"location":"dokumentasjon/overview/#drift","title":"Drift","text":""},{"location":"dokumentasjon/overview/#workflows-og-kjretidspunkt","title":"Workflows og kj\u00f8retidspunkt","text":"<p>Inneholder informasjon om viktige punkter for kj\u00f8retider</p>"},{"location":"dokumentasjon/overview/#tilgangsstyring","title":"Tilgangsstyring","text":"<p>Er det noen spesielle rettigheter som kreves for denne komponenten?</p>"},{"location":"dokumentasjon/overview/#overvaking-og-datakvalitet","title":"Overv\u00e5king og datakvalitet","text":""},{"location":"dokumentasjon/overview/#datakvalitet","title":"Datakvalitet","text":"<p>Det kj\u00f8res datakvalitetsm\u00e5linger for disse tabellene</p>"},{"location":"dokumentasjon/overview/#overvaking","title":"Overv\u00e5king","text":"<p>F\u00f8lgende Sitescope-monitorer kj\u00f8res for denne komponenten.</p>"},{"location":"dokumentasjon/overview/#sikkerhet-og-personvern","title":"Sikkerhet og personvern","text":"<p>Inneholder detaljer rundt f.eks tilgang</p> <p>Det er ikke utarbeidet PVK for denne komponenten.</p> <p>H\u00e5ndtering av kode 6 og 7: Under arbeid</p>"},{"location":"dokumentasjon/overview/#backlog","title":"Backlog","text":"<p>Lenke til jira-oversikt?</p>"},{"location":"dokumentasjon/overview/#dbt-docs-brukerguide","title":"dbt docs - brukerguide","text":""},{"location":"dokumentasjon/overview/#navigasjon","title":"Navigasjon","text":"<p>Du kan bruke navigasjonsfanene <code>Project</code> og <code>Database</code> p\u00e5 venstre side av vinduet for \u00e5 utforske modellene i komponenten.</p>"},{"location":"dokumentasjon/overview/#prosjektfane","title":"Prosjektfane","text":"<p><code>Prosjekt</code>-fanen speiler katalogstrukturen til dbt-prosjektet ditt. I denne fanen kan du se alle modeller definert i dbt-prosjektet ditt, samt modeller importert fra dbt-pakker.</p>"},{"location":"dokumentasjon/overview/#database-fanen","title":"Database-fanen","text":"<p>Fanen <code>Database</code> viser ogs\u00e5 modellene dine, men i et format som ser mer ut som en databaseutforsker. Denne utsikten viser relasjoner (tabeller og visninger) gruppert i databaseskjemaer. Merk at <code>ephemeral</code> modeller ikke vises i dette grensesnittet, da de ikke finnes i databasen.</p>"},{"location":"dokumentasjon/overview/#grafutforskning","title":"Grafutforskning","text":"<p>Du kan klikke p\u00e5 det bl\u00e5 ikonet nederst til h\u00f8yre p\u00e5 siden for \u00e5 se lineage til modellene dine.</p> <p>P\u00e5 modellsidene vil du se de n\u00e6rmeste foreldrene og barna til modellen du utforsker. Ved \u00e5 klikke p\u00e5 <code>Expand</code>. knappen \u00f8verst til h\u00f8yre i denne avstamningsruten, vil du kunne se alle modellene som brukes til \u00e5 bygge, eller er bygget fra, modellen du utforsker.</p> <p>N\u00e5r den er utvidet, vil du kunne bruke <code>--select</code> og <code>--exclude</code> modellvalgsyntaks for \u00e5 filtrere modeller i grafen. For mer informasjon om modellvalg, sjekk ut dbt docs.</p> <p>Merk at du ogs\u00e5 kan h\u00f8yreklikke p\u00e5 modeller for \u00e5 filtrere og utforske grafen interaktivt.</p>"},{"location":"dokumentasjon/overview/#mer-info","title":"Mer info","text":"<ul> <li>Hva er dbt</li> </ul> <p>{% enddocs %}</p>"},{"location":"feilsoking/feilsoking/","title":"Feils\u00f8king","text":"<p>Samleside for vanlige feilsistuasjoner som kan oppst\u00e5 med dbt og Oracle i NAV</p>"},{"location":"feilsoking/feilsoking/#incremental","title":"Incremental","text":""},{"location":"feilsoking/feilsoking/#ora-00955-det-finnes-allerede-et-objekt-med-det-navnet","title":"ORA-00955: det finnes allerede et objekt med det navnet","text":"<p>???</p>"},{"location":"feilsoking/feilsoking/#ora-00904-kolonne-invalid-identifier","title":"ORA-00904: \"KOLONNE\": invalid identifier","text":"<p>Dersom <code>persist_docs</code> er aktivert i dbt_project.yml, ta en titt p\u00e5 siden om Dokumentasjon.</p>"},{"location":"feilsoking/feilsoking/#kobling-mot-oracle-database","title":"Kobling mot oracle database","text":""},{"location":"feilsoking/feilsoking/#dpy-2029-https_proxy-requires-use-of-the-tcps-protocol","title":"DPY-2029: https_proxy requires use of the tcps protocol","text":"<p>Bytte fra thin mode til cx mode. I outputen du f\u00e5r i terminalen, sjekk hvilken mode du kj\u00f8rer i. Kj\u00f8rer du i thin mode endr det til cx mode. Dette gj\u00f8res ved \u00e5 bruke Oracle Instant Client. Sett path til Oracle Instant Client i milj\u00f8veriabler og slett ORA_PYTHON_DRIVER_TYPE=thin fra milj\u00f8variabler.</p>"},{"location":"prosjekter/","title":"Prosjekter","text":"<p>Her finner du en oversikt over noen dbt-prosjekter. Dokumentasjon for produkter finner du p\u00e5 DBT Docs by nada</p>"},{"location":"prosjekter/bomlo-dbt/","title":"bomlo-dbt","text":"<p>Eies av PO Helse</p>"},{"location":"prosjekter/bomlo-dbt/#formal","title":"Form\u00e5l","text":"<p>DBT-prosjekt for Team B\u00f8mlo.</p>"},{"location":"prosjekter/bomlo-dbt/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: bomlo-dbt</li> <li>GitHub: navikt/bomlo-dbt</li> </ul> <p>slack: #team-b\u00f8mlo-v\u00e6rs\u00e5god</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/","title":"dvh-sykefravar-dmx","text":"<p>Eies av Team Sykefrav\u00e6r</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/#formal","title":"Form\u00e5l","text":"<p>Analysetorg brukt til syfo (sykefrav\u00e6rsoppfoling)</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>DBT: https://navikt.github.io/dvh-sykefravar-dmx</li> <li>GitHub: navikt/dvh-sykefravar-dmx</li> <li>Confluence:<ul> <li>Datavarehus/Systemomr\u00e5der/Sykefrav\u00e6r/Sykefrav\u00e6r - sykefrav\u00e6rsoppf\u00f8lging - intern statistikk for NAV-kontorene</li> <li>NAV Datavarehus/Om oss/Team St\u00f8nadsstatistikk (STO)/Produktteam Sykefrav\u00e6r / Dagens sykefrav\u00e6rstatistikk i Datavarehuset</li> </ul> </li> </ul> <p>slack: #dv-team-sykefrav\u00e6r</p>"},{"location":"prosjekter/dvh_arb_cv/","title":"dvh_arb_cv","text":"<p>Eies av A-Team</p>"},{"location":"prosjekter/dvh_arb_cv/#formal","title":"Form\u00e5l","text":"<p>Siste versjon av CV-elementer og jobb\u00f8nsker per person registrert arbeidss\u00f8ker NAV.</p>"},{"location":"prosjekter/dvh_arb_cv/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: dvh_arb_cv</li> <li>GitHub: navikt/dvh_arb_cv</li> <li>Confluence:<ul> <li>dvh_arb_cv - data fra Arbeidsplassen.no - CV</li> </ul> </li> </ul> <p>slack: #dv-a-team</p>"},{"location":"prosjekter/dvh_arb_permittering/","title":"dvh_arb_permittering","text":"<p>Eies av A-Team</p>"},{"location":"prosjekter/dvh_arb_permittering/#formal","title":"Form\u00e5l","text":"<p>NAV har behov for \u00e5 samle statistikk for oversikt over permitterte arbeidss\u00f8kere og forh\u00e5ndsmelding om permittering og masseoppsigelser.</p> <p>Arbeidsgivere som vurderer \u00e5 g\u00e5 til masseoppsigelser eller permitteringer, gir melding om dette til NAV. Fra 2020 blir disse meldingene sendt inn elektronisk til NAV, og registreres i l\u00f8sningen Permittering. </p> <p>Dekker i f\u00f8rste omgang forh\u00e5ndsmelding om permittering, dvs n\u00e5r virksomheter permittere over 10 personer s\u00e5 skal de melde til NAV p\u00e5 forh\u00e5nd.</p>"},{"location":"prosjekter/dvh_arb_permittering/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: </li> <li>GitHub: navikt/dvh_arb_permittering</li> <li>Confluence: dvh_arb_permittering</li> </ul> <p>slack: #dv-a-team</p>"},{"location":"prosjekter/dvh_arb_person/","title":"dvh_arb_person","text":"<p>Eies av A-Team</p>"},{"location":"prosjekter/dvh_arb_person/#formal","title":"Form\u00e5l","text":"<p>Arbeidsmakedsstatistikken.</p>"},{"location":"prosjekter/dvh_arb_person/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: </li> <li>GitHub: navikt/dvh_arb_person</li> <li>Confluence: dvh_arb_person - ny arbeidsmarkedsstatistikk</li> </ul> <p>slack: #dv-a-team</p>"},{"location":"prosjekter/dvh_arb_styrke_ssb/","title":"dvh_arb_styrke_ssb","text":"<p>Eies av A-Team</p>"},{"location":"prosjekter/dvh_arb_styrke_ssb/#formal","title":"Form\u00e5l","text":"<p>Komponenten leser data inn fra SSB i to forskjellige l\u00f8p:</p> <ul> <li>Den ene delen leser inn data om arbeidsstyrken fra flatfil, direkte levert fra SSB kun for NAV. Denne delen h\u00e5ndterer personopplysninger.</li> <li>Den andre delen leser data om arbeidsstyrken, fordelt p\u00e5 yrke/kj\u00f8nn fra SSB's offisielle statistikkbank. Inneholder ikke personopplysninger eller geografisk informasjon.</li> </ul>"},{"location":"prosjekter/dvh_arb_styrke_ssb/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: </li> <li>GitHub: navikt/dvh_arb_styrke_ssb</li> <li>Confluence: dvh_arb_styrke_ssb</li> </ul> <p>slack: #dv-a-team</p>"},{"location":"prosjekter/dvh_arb_tiltak/","title":"dvh_arb_tiltak","text":"<p>Eies av Team Oppf\u00f8lging Eies av Team Oppf\u00f8lging)</p>"},{"location":"prosjekter/dvh_arb_tiltak/#formal","title":"Form\u00e5l","text":"<p>Brukes i Tiltaks- og oppf\u00f8lgingsstatistikken.</p>"},{"location":"prosjekter/dvh_arb_tiltak/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>dbt: </li> <li>GitHub: navikt/dvh_arb_tiltak</li> <li>Confluence: dvh_arb_person - ny arbeidsmarkedsstatistikk</li> </ul> <p>slack: #dv-oppf\u00f8lging</p>"},{"location":"prosjekter/nystol/vdl-regnskapsdata/","title":"vdl-regnskapsdata","text":"<p>Eies av Team-VDL</p>"},{"location":"prosjekter/nystol/vdl-regnskapsdata/#formal","title":"Form\u00e5l","text":"<p>Analysedata av hovedbok</p>"},{"location":"prosjekter/nystol/vdl-regnskapsdata/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>GitHub: navikt/vdl-regnskapsdata</li> <li>Virksomhetsdata:<ul> <li>Om oss</li> <li>Hovedbok</li> </ul> </li> <li>DBT: TODO!</li> </ul> <p>slack: #virksomhetsdatalaget</p>"}]}