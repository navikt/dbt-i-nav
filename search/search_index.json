{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Installere DBT p\u00e5 VDI","text":""},{"location":"#forutsetninger","title":"Forutsetninger","text":"<p>For \u00e5 installere dbt m\u00e5 du ha f\u00f8lgende installert:</p> <ul> <li>Python 3.10.x</li> <li>PIP og oppsett av sertifikater</li> <li>GIT / GitHub Desktop</li> <li>Oracle client library</li> </ul>"},{"location":"#anbefalinger","title":"Anbefalinger","text":"<p>For en god utvikleropplevelse anbefaler vi deg \u00e5 ha f\u00f8lgende installert:</p> <ul> <li>Visual studio code eller en annen tekst editor</li> <li>SQLFluff</li> </ul>"},{"location":"arkitektur/style_guide/","title":"DBT Stil Guide","text":"<p>forket fra https://github.com/dbt-labs/corp/blob/main/dbt_style_guide.md</p>"},{"location":"arkitektur/style_guide/#modell-naming","title":"Modell Naming","text":"<p>V\u00e5r modellere organiserers inn i tre hovedgrupper: staging, marts, base/intermediate. See f\u00f8lgnede diskusjon. The navngiving blir som f\u00f8lger: <pre><code>\u251c\u2500\u2500 dbt_project.yml\n\u2514\u2500\u2500 models\n    \u251c\u2500\u2500 marts\n    |   \u2514\u2500\u2500 core\n    |       \u251c\u2500\u2500 mellomlager\n    |       |   \u251c\u2500\u2500 mellomlager.yml\n    |       |   \u251c\u2500\u2500 posteringer__unionisert.sql\n    |       |   \u2514\u2500\u2500 posteringer__gruppert.sql\n    |       \u251c\u2500\u2500 core.docs\n    |       \u251c\u2500\u2500 dim_artskonti\n    |           \u251c\u2500\u2500 dim_artskonti.yml\n    |           \u2514\u2500\u2500 dim_artskonti.sql\n    |       \u251c\u2500\u2500 dim_konstnadssteder\n    |           \u251c\u2500\u2500 dim_konstnadssteder.yml\n    |           \u2514\u2500\u2500 dim_konstnadssteder.sql\n    |       \u2514\u2500\u2500 fak_hovedbok_posteringer\n    |           \u251c\u2500\u2500 fak_hovedbok_posteringer.yml\n    |           \u2514\u2500\u2500 fak_hovedbok_posteringer.sql\n    \u2514\u2500\u2500 staging\n        \u2514\u2500\u2500 oebs\n            \u251c\u2500\u2500 base\n            |   \u251c\u2500\u2500 base.yml\n            |   \u2514\u2500\u2500 base__oebs_kontoplan.sql\n            \u251c\u2500\u2500 src_oebs.yml\n            \u251c\u2500\u2500 src_oebs.docs\n            \u251c\u2500\u2500 stg_oebs__posteringerslinjer\n            |   \u251c\u2500\u2500 stg_oebs__posteringerslinjer.yml\n            |   \u2514\u2500\u2500 stg_oebs__posteringerslinjer.sql\n            \u251c\u2500\u2500 stg_oebs__budjsett_balanser\n            |   \u251c\u2500\u2500 stg_oebs__budjsett_balanser.yml\n            |   \u2514\u2500\u2500 stg_oebs__budjsett_balanser.sql\n</code></pre> - All objekter oppgis p\u00e5 flertallsform, slik som: <code>stg_oebs__hovedbok_posteringslinjer</code>, <code>stg_oebs__artskonti</code>, etc. - Basetabeller prefikses med <code>base__</code>, slik som: <code>base__&lt;source&gt;_&lt;object&gt;</code> - Mellomlagringstabeller skal avsluttes med et fortidsverb som indikerer hvilken handling som er gjort p\u00e5 objektet, slik som: <code>hovedbok_posteringslinjer__filtrert_budsjett</code> - Datatorg, eller marter, er fordelt mellom faktaer (uforandelig, verb) og dimensjoner (foranderlig, subjekt) og prefikses med <code>fak_</code> og <code>dim_</code>, henholdvis.  - Staged strukter inneholder alle kolonner fra r\u00e5-tabellen og utvides med avledede kolonner, for \u00e5 angi naturlig n\u00f8kler, hashed n\u00f8kler, omd\u00f8ping av kolonnenavn, etc. </p>"},{"location":"arkitektur/style_guide/#model-konfigurasjon","title":"Model konfigurasjon","text":"<ul> <li>Model-spesifike attributer (som sort/dist keys) skal spesifiseres i modellen.</li> <li>Hvis en spesifikk konfigurasjon som gjelder alle modeller i en folder, burde dette spesifiseres i <code>dbt_project.yml</code>.</li> <li>Modell konfigurationer skal spesifiseres slik:</li> </ul> <p><pre><code>{{\n  config(\n    materialized = 'table',\n    sort = 'id',\n    dist = 'id'\n  )\n}}\n</code></pre> - Marter b\u00f8r alltid configureres som tabeller - med mindre det er sv\u00e6rt gode grunner til \u00e5 ikke gj\u00f8re det. </p>"},{"location":"arkitektur/style_guide/#dbt-konvensjoner","title":"DBT konvensjoner","text":"<ul> <li>Kun <code>stg_</code>og <code>base_</code> sp\u00f8r mot <code>source</code>er.</li> <li>Alle andre <code>ref</code> andre modeller.</li> </ul>"},{"location":"arkitektur/style_guide/#tester","title":"Tester","text":"<ul> <li>Hver underfolder inneholder en <code>.yml</code> fil som tester alle modeller i folderen. Navnestandarden skal v\u00e6re <code>&lt;folder-navn&gt;.yml</code>. </li> <li>Som et minimum, skal <code>unique</code> og <code>not_null</code> v\u00e6re testet p\u00e5 prim\u00e6r n\u00f8kkeler</li> </ul>"},{"location":"arkitektur/style_guide/#navngivining-og-felt-konvensjoner","title":"Navngivining og felt konvensjoner","text":"<ul> <li>Skjema, tabell og kolonne nanv skal v\u00e6re <code>snake_case</code>.</li> <li>Bruk navn basert p\u00e5 business terminologien, i stedet for kilde terminology.</li> <li>Hver model skal ha en prim\u00e6r n\u00f8kkel.</li> <li>Prim\u00e6r n\u00f8kkeler i modellen navngis som <code>pk_&lt;objekt&gt;</code>, alts\u00e5 <code>pk_dim_person</code>. </li> <li>Fremmed n\u00f8kkeler angis som <code>fk_&lt;objekt&gt;</code>, tidsl\u00f8se enhets n\u00f8kkeler angis som <code>ek_&lt;objekt&gt;</code> og naturlige n\u00f8kkeler angis som <code>lk_&lt;objekt&gt;</code>. </li> <li>For base og stage modeller skal felter v\u00e6re ordnet inne kategorier, fra identifikatorer til tidsstempler tilslutt. </li> <li>Tidsstempel kolonner skal v\u00e6ver navngitt som <code>&lt;hendelse&gt;_ts</code>, e.g. <code>lastet_ts</code>, og skal v\u00e6re p\u00e5 UTC. for avvikende tidszoner skal tidzonen indikeres ved suffiks, e.g <code>lastet_ts_pt</code>.</li> <li>Boolean verdier og skal oppgis mot <code>er_</code> eller <code>har_</code> og uttrykkes med 1 for <code>Ja</code> og 0 for <code>Nei</code>.</li> <li>Bel\u00f8ps kolonner skal ha suffiks <code>_nok</code>for, flyttalls, bel\u00f8p i kroner, og <code>_orer</code> for heltall bel\u00f8p i \u00f8rer.</li> <li>S\u00e6r norske bokstaver som \u00c6, \u00d8, \u00c5 skal angis som <code>ae</code>, <code>o</code> og <code>a</code>.</li> <li>Unng\u00e5r reservert word som kolonne navn. </li> <li>Bruk samme feltnavn gjennom alle modellene hvor mulig, e.g. n\u00f8kkelen til <code>dim_person</code> skal v\u00e6re <code>pk_dim_person</code>og ikke <code>pk_bruker</code>.</li> </ul>"},{"location":"arkitektur/style_guide/#cteer","title":"CTEer","text":"<p>For mer informasjon om hvorfor vi bruker CTEer, see f\u00f8lgende post. Kortversjonen er at det hjelper oss \u00e5 samle kildene \u00f8verst, gj\u00f8re enkle transformasjoner og joiner i midten og se resultatet nederst. Oracle skal st\u00f8tte passthrough slik at masse wither p\u00e5 rad ikke p\u00e5virker ytelsen.</p> <ul> <li>Alle <code>{{ ref('...') }}</code> settning skal plasseres i en egen CTE, ved toppen av fila. </li> <li>Hvor det er mulig, skal en CTE gj\u00f8re en og kun en logisk mengde arbeid. </li> <li>CTE navn skal v\u00e6re ordrike og beskrive hva denne faktisk gj\u00f8r. </li> <li>CTE er med forvirrende eller avansert logik skal kommenteres like etter at den er definert.  <pre><code>with\n\nhendelser_vask as (\n\n-- Kommentarer\n-- mer kommentarer\n...\n)\n</code></pre> ),</li> <li>CTEer som gjenbrukes i feller modeller skal tas ut og bli egne modeller. </li> <li>Modeller b\u00f8r avsluttest med en  <code>endelig</code> CTE som selekterer hele det endelig produktet f\u00f8r modelen avslutted <code>SELECT * FROM endelig</code>. </li> <li>CTEene skal formatere som f\u00f8lger:</li> </ul> <pre><code>WITH\n\nhendelser AS (\n\n...\n\n),\n\n-- CTE comments go here\nfiltrerte_hendelser AS (\n\n...\n\n),\n\nendelig AS (\n\nSELECT * FROM filtrerte_hendelser\n\n),\n\n\nSELECT * FROM endelig\n</code></pre>"},{"location":"arkitektur/style_guide/#sql-stil-guide","title":"SQL stil guide","text":"<ul> <li>Sett komma p\u00e5 slutten setningen</li> <li>Bruke fire mellom rom for \u00e5 indentere koden, uten om ved predikatet, som skal v\u00e6re p\u00e5 linje med <code>WHERE</code></li> <li>Ingen linjer skal v\u00e6re lenger enn 80 tegn</li> <li>All felt navn skal v\u00e6re skrevet med sm\u00e5 bokstaver, og alle funksjonsnavn (<code>SELECT</code>, <code>WHERE</code>, <code>LEAD</code>, etc.) med STORE. </li> <li>Bruk alltid <code>AS</code>for \u00e5 aliase tabeller og felt. </li> <li>Alle felt skal angis f\u00f8r alle aggregater og vindu funskjoner. </li> <li>Aggregering skal skal l\u00f8ses s\u00e5 tidlig som mulig, f\u00f8r en joiner med andre tabeller. </li> <li><code>ORDER BY</code>og <code>GROUP BY</code> skal v\u00e6r angitt med nummer i stedet for kolonne navn (se f\u00f8lgende for why). Gruppering b\u00f8r gj\u00f8res p\u00e5 kun noen f\u00e5 kolonne verdier. </li> <li>Bruk helst <code>UNION ALL</code> fremfor <code>UNION</code> *</li> <li>Unng\u00e5 bruk tabell alias i <code>JOIN</code> criterer. Det er ofte vanskelig \u00e5 forst\u00e5 hvor tabellen \"c\" kommer fra.</li> <li>Hvis en joiner to eller flere tabeller, alltid prefiks kolonenne med et table alias. Hvis en selekterer fra kun en tabell trengs ingen prefiks. </li> <li>Skriv eksplisite joins, alts\u00e5 skriv <code>INNER JOIN</code> instead of <code>JOIN</code>). </li> <li> <p>Bruk <code>LEFT JOIN</code> fremfor <code>RIGHT JOIN</code> </p> </li> <li> <p>Ikke optimaliserer for f\u00e5 linjer kode. Nye linjer er billig, hjerner er dyre</p> </li> </ul>"},{"location":"arkitektur/style_guide/#eksempel-sql","title":"Eksempel SQL","text":"<pre><code>WITH\n\nmin_data AS (\n\nSELECT * FROM {{ ref('min_data') }}\n\n),\n\nen_cte AS (\n\nSELECT * FROM {{ ref('en_cte') }}\n\n),\n\nen_cte_agg AS (\n\nSELECT\nid,\nSUM(felt_4) AS total_felt_4,\nMAX(felt_5) AS max_felt_5\n\nFROM en_cte\nGROUP BY 1\n\n),\n\nendelig AS (\n\nSELECT [DISITNCT]\nmin_data.felt_1,\nmin_data.felt_2,\nmin_data.felt_3,\n\n-- Bruk linjeshift for visuelt separere kalkulasjoner inn i blokker.\nCASE\nWHEN min_data.kansellerings_dato IS NULL\nAND min_data.utgangs_dato is not null\nTHEN utgangsdato_date\nWHEN my_data.kansellerings_dato IS NULL\nTHEN my_data.start_dato + 7\nELSE my_data.kansellerings_date\nEND AS kansellerings_dato,\n\nen_cte_agg.total_felt_4,\nen_cte_agg.max_felt_5\n\nFROM min_data\nLEFT JOIN en_cte_agg  ON min_data.id = en_cte_agg.id\nWHERE min_data.felt_1 = 'abc'\nAND (\nmin_data.felt_2 = 'def' OR\nmin_data.felt_2 = 'ghi'\n)\nHAVING COUNT(*) &gt; 1\n\n)\n\nSELECT * FROM final\n</code></pre> <ul> <li>Bruk <code>LEFT JOIN</code> fremfor <code>RIGHT JOIN</code>: <pre><code>SELECT\nreiser.*,\nsjaforer.rating AS driver_rating,\npassasjerer.rating AS rider_rating\n\nFROM resier\nLEFT JOIN personer AS sjaforer\nON reiser.fk_personer_sjaforer = sjaforer.pk_personer\nLEFT JOIN personer AS passasjerer\nON reiser.fk_personer_passasjerer = sjaforer.pk_personer\n</code></pre></li> </ul>"},{"location":"arkitektur/style_guide/#yaml-stil-guide","title":"YAML stil guide","text":"<ul> <li>Setning indenteres med to mellomrom </li> <li>Lister skal v\u00e6re indentert </li> <li>Bruk linjeskift for \u00e5 separere lister n\u00e5r n\u00f8dvendig. </li> <li>Linjer skal ikke v\u00e6re lenger en 80 karakterer </li> </ul>"},{"location":"arkitektur/style_guide/#eksample-yaml","title":"Eksample YAML","text":"<pre><code>version: 2\n\nmodels:\n- name: hendelser\ncolumns:\n- name: pk_hendelser\ndescription: Dette er n prim\u00e6rn\u00f8kkel\ntests:\n- unique\n- not_null\n\n- name: hendelse_ts description: \"N\u00e5r hendelse skjedde i UTC (eg. 2018-01-01 12:00:00)\"\ntests:\n- not_null\n\n- name: fk_brukere\ndescription: Brukeren som st\u00e5 for hendelsen tests:\n- not_null\n- relationships:\nto: ref('brukere')\nfield: pk_brukere\n</code></pre>"},{"location":"arkitektur/style_guide/#jinja-stil-guide","title":"Jinja stil guide","text":"<ul> <li>Ved inklusjon av Jinja kode bruk mellomrom p\u00e5 iden av klammene <code>{{ slik }}</code> istedefor <code>{{slik}}</code></li> <li>Bruk ny linje for \u00e5 dele opp logik i Jinja blokker</li> </ul>"},{"location":"dokumentasjon/dokumentasjon/","title":"Dokumentasjon","text":""},{"location":"dokumentasjon/dokumentasjon/#tabelldokumentasjon","title":"Tabelldokumentasjon","text":"<p>Tabellene konfigureres og dokumenteres i <code>yml</code> filene i hver mappe i prosjektet. Kommentarer kan settes p\u00e5 b\u00e5de tabellniv\u00e5 og kolonneniv\u00e5. Les mer her.</p>"},{"location":"dokumentasjon/dokumentasjon/#persist-docs","title":"Persist docs","text":"<p>dbt-oracle har st\u00f8tte for \u00e5 skrive kommentarer til databasen. Som andre konfig,  kan det settes p\u00e5 prosjektniv\u00e5, mappeniv\u00e5 eller modellniv\u00e5. For \u00e5 sette det p\u00e5 prosjektniv\u00e5, legg til f\u00f8lgende i <code>dbt_project.yml</code> <pre><code>models:\n  +persist_docs:\n    relation: true\n    columns: true\n</code></pre></p> <p>En ting \u00e5 v\u00e6re oppmerksom p\u00e5 n\u00e5r <code>persist_docs</code> er aktivert er at kolonnenavn i modellen m\u00e5 v\u00e6re det samme som definert i yml filen.</p> <p>ORA-00904</p> <pre><code>ORA-00904: \"KOLONNE\": invalid identifier\n</code></pre> <pre><code>SELECT\nkolonne\nFROM ...\n</code></pre> <pre><code>- name: kolonne_navn\ndescription: ...\n</code></pre> <p>Her har Oracle fors\u00f8kt \u00e5 skrive kommentar til en kolonne som ikke eksisterer. Sammenlign modell og yml fil og sjekk at navnet p\u00e5 kolonnen er lik.</p>"},{"location":"dokumentasjon/dokumentasjon/#overskrive-overview","title":"Overskrive overview","text":"<p>Komponentdokumentasjonen kan integreres i dbt dokumentasjonen. I <code>dbt/models</code> folderen m\u00e5 det opprettes en <code>overview.md</code> fil. Bruk gjerne overview.md som mal</p>"},{"location":"dokumentasjon/dokumentasjon/#deployere-dokumentasjon","title":"Deployere dokumentasjon","text":""},{"location":"dokumentasjon/overview/","title":"Overview","text":"<p>{% docs overview %}</p>"},{"location":"dokumentasjon/overview/#xxx-komponenten","title":"XXX - komponenten","text":""},{"location":"dokumentasjon/overview/#formal","title":"Form\u00e5l","text":"<p>Overordnet beskrivelse av form\u00e5l med l\u00f8sningen</p>"},{"location":"dokumentasjon/overview/#komponentbeskrivelse","title":"Komponentbeskrivelse","text":"<ul> <li>Form\u00e5l: </li> <li>Prinsipper:</li> <li>Kilde(r):</li> <li>Brukere:</li> <li>Noe annet:</li> </ul>"},{"location":"dokumentasjon/overview/#struktur-pa-repo","title":"Struktur p\u00e5 repo","text":"<p>Lenke til dokumentasjon p\u00e5 confluence</p> <p>Vi har f\u00f8lgende mapper: - db (medf\u00f8lgende readme)   - install (her ligger ddl filer per tabell/view. Ogs\u00e5 dcl-filer som gir grants)   - patch (hvert script har jira-kode som prefiks og kort forklaring/tabellnavn). N\u00e5r man endrer en tabell her m\u00e5 man ogs\u00e5 endre den i install-filen)   - utils (kanskje, hvis man trenger det) - dbt - dbt prosjektet. dette er stien der man kj\u00f8rer dbt kommandoer.</p>"},{"location":"dokumentasjon/overview/#overordnet-design","title":"Overordnet design","text":""},{"location":"dokumentasjon/overview/#dataflyt-diagram","title":"Dataflyt-diagram","text":"<p>Dataflyten finnes ved \u00e5 klikke p\u00e5 det bl\u00e5 ikonet nederst til h\u00f8yre p\u00e5 siden </p> # DAG task kilde m\u00e5l kommentar"},{"location":"dokumentasjon/overview/#databasebeskrivelse","title":"Databasebeskrivelse","text":"<p>En oversikt over de viktigste tabellene</p> Tabell/Views Beskrivelse tabell1 besk tabell2 besk"},{"location":"dokumentasjon/overview/#databasescript","title":"Databasescript","text":"<p>Referanser til hvor databasescriptene befinner seg</p>"},{"location":"dokumentasjon/overview/#drift","title":"Drift","text":""},{"location":"dokumentasjon/overview/#workflows-og-kjretidspunkt","title":"Workflows og kj\u00f8retidspunkt","text":"<p>Inneholder informasjon om viktige punkter for kj\u00f8retider</p>"},{"location":"dokumentasjon/overview/#tilgangsstyring","title":"Tilgangsstyring","text":"<p>Er det noen spesielle rettigheter som kreves for denne komponenten?</p>"},{"location":"dokumentasjon/overview/#overvaking-og-datakvalitet","title":"Overv\u00e5king og datakvalitet","text":""},{"location":"dokumentasjon/overview/#datakvalitet","title":"Datakvalitet","text":"<p>Det kj\u00f8res datakvalitetsm\u00e5linger for disse tabellene</p>"},{"location":"dokumentasjon/overview/#overvaking","title":"Overv\u00e5king","text":"<p>F\u00f8lgende Sitescope-monitorer kj\u00f8res for denne komponenten.</p>"},{"location":"dokumentasjon/overview/#sikkerhet-og-personvern","title":"Sikkerhet og personvern","text":"<p>Inneholder detaljer rundt f.eks tilgang</p> <p>Det er ikke utarbeidet PVK for denne komponenten.</p> <p>H\u00e5ndtering av kode 6 og 7: Under arbeid</p>"},{"location":"dokumentasjon/overview/#backlog","title":"Backlog","text":"<p>Lenke til jira-oversikt?</p>"},{"location":"dokumentasjon/overview/#dbt-docs-brukerguide","title":"dbt docs - brukerguide","text":""},{"location":"dokumentasjon/overview/#navigasjon","title":"Navigasjon","text":"<p>Du kan bruke navigasjonsfanene <code>Project</code> og <code>Database</code> p\u00e5 venstre side av vinduet for \u00e5 utforske modellene i komponenten.</p>"},{"location":"dokumentasjon/overview/#prosjektfane","title":"Prosjektfane","text":"<p><code>Prosjekt</code>-fanen speiler katalogstrukturen til dbt-prosjektet ditt. I denne fanen kan du se alle modeller definert i dbt-prosjektet ditt, samt modeller importert fra dbt-pakker.</p>"},{"location":"dokumentasjon/overview/#database-fanen","title":"Database-fanen","text":"<p>Fanen <code>Database</code> viser ogs\u00e5 modellene dine, men i et format som ser mer ut som en databaseutforsker. Denne utsikten viser relasjoner (tabeller og visninger) gruppert i databaseskjemaer. Merk at <code>ephemeral</code> modeller ikke vises i dette grensesnittet, da de ikke finnes i databasen.</p>"},{"location":"dokumentasjon/overview/#grafutforskning","title":"Grafutforskning","text":"<p>Du kan klikke p\u00e5 det bl\u00e5 ikonet nederst til h\u00f8yre p\u00e5 siden for \u00e5 se lineage til modellene dine.</p> <p>P\u00e5 modellsidene vil du se de n\u00e6rmeste foreldrene og barna til modellen du utforsker. Ved \u00e5 klikke p\u00e5 <code>Expand</code>. knappen \u00f8verst til h\u00f8yre i denne avstamningsruten, vil du kunne se alle modellene som brukes til \u00e5 bygge, eller er bygget fra, modellen du utforsker.</p> <p>N\u00e5r den er utvidet, vil du kunne bruke <code>--select</code> og <code>--exclude</code> modellvalgsyntaks for \u00e5 filtrere modeller i grafen. For mer informasjon om modellvalg, sjekk ut dbt docs.</p> <p>Merk at du ogs\u00e5 kan h\u00f8yreklikke p\u00e5 modeller for \u00e5 filtrere og utforske grafen interaktivt.</p>"},{"location":"dokumentasjon/overview/#mer-info","title":"Mer info","text":"<ul> <li>Hva er dbt</li> </ul> <p>{% enddocs %}</p>"},{"location":"feilsoking/feilsoking/","title":"Feils\u00f8king","text":"<p>Samleside for vanlige feilsistuasjoner som kan oppst\u00e5 med dbt og Oracle i NAV</p>"},{"location":"feilsoking/feilsoking/#incremental","title":"Incremental","text":""},{"location":"feilsoking/feilsoking/#ora-00955-det-finnes-allerede-et-objekt-med-det-navnet","title":"ORA-00955: det finnes allerede et objekt med det navnet","text":"<p>???</p>"},{"location":"feilsoking/feilsoking/#ora-00904-kolonne-invalid-identifier","title":"ORA-00904: \"KOLONNE\": invalid identifier","text":"<p>Dersom <code>persist_docs</code> er aktivert i dbt_project.yml, ta en titt p\u00e5 siden om Dokumentasjon.</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/","title":"dvh-sykefravar-dmx","text":"<p>Pilot prosjekt for bruk av dbt.</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/#formal","title":"Form\u00e5l","text":"<p>TODO!</p> <p>Analysetorg brukt til syfo (sykefrav\u00e6rsoppfoling)</p>"},{"location":"prosjekter/dvh-sykefravar-dmx/#dokumentasjon","title":"Dokumentasjon","text":"<ul> <li>DBT: https://navikt.github.io/dvh-sykefravar-dmx</li> <li>GitHub: navikt/dvh-sykefravar-dmx</li> <li>Confluence:<ul> <li>Datavarehus/Systemomr\u00e5der/Sykefrav\u00e6r/Sykefrav\u00e6r - sykefrav\u00e6rsoppf\u00f8lging - intern statistikk for NAV-kontorene</li> <li>NAV Datavarehus/Om oss/Team St\u00f8nadsstatistikk (STO)/Produktteam Sykefrav\u00e6r / Dagens sykefrav\u00e6rstatistikk i Datavarehuset</li> </ul> </li> </ul>"},{"location":"vdi/dbt/","title":"DBT","text":"<p>Det finnes en offisiell oracle adapter for dbt v1.x. Gjerne start med \u00e5 ta en titt p\u00e5 denne installasjonsguiden f\u00f8rst.</p>"},{"location":"vdi/dbt/#installasjon","title":"Installasjon","text":"<p>dbt kan installeres sammen med oracle adapteren med kommandoen:</p> <pre><code>pip install dbt-oracle\n</code></pre> <p>Nedlasting feiler</p> <pre><code>$ pip install dbt-oracle\nWARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)'))': /simple/dbt-oracle/\n\n...\n\nCould not fetch URL https://pypi.org/simple/dbt-oracle/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/dbt-oracle/ (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)')))\n</code></pre> <p>Sjekk om du har gjort oppsett av sertifikater til pip.</p> <p>Installasjon feiler</p> <p>I noen tilfeller har vi opplevd at Microsoft Visual C++ mangler.</p>"},{"location":"vdi/dbt/#opprette-nytt-dbt-prosjekt-for-oracle","title":"Opprette nytt dbt prosjekt for Oracle","text":"<p>Oppsettet av nytt prosjekt er forenklet og tilpasset datavarehus. Det er laget eksempelprosjekt i dvh_template for bruk av dbt til komponentskjemaer. dbt prosjektet ligger da under mappen dbt.</p> <ul> <li>For nye komponenter er det bare \u00e5 opprette nytt github repo med utgangspunkt i dvh_template.</li> <li>For eksisterende komponentrepoer, ta en kopi av dbt og lim inn i roten til komponentrepoet.</li> </ul> <p>Se dokumentasjon for \u00e5 ta i bruk prosjektet for detaljer.</p> <p>Hvis du ikke \u00f8nsker \u00e5 ta i bruk standardprosjektet, men heller kj\u00f8re <code>dbt init</code> er det noen ting som kan skape uforst\u00e5elige feilmeldinger:</p>"},{"location":"vdi/dbt/#quoting","title":"Quoting","text":"<p>Quoting av databasenavn m\u00e5 aktiveres i <code>dbt_project.yml</code> siden databasenenavnene til dvh-databasene er med sm\u00e5 bokstaver (eks. dwhu1). Hvis ikke dette gj\u00f8res kommer det feilmeling som sier noe slikt som <code>approximate match</code></p> <p>For \u00e5 skru p\u00e5 quoting m\u00e5 f\u00f8lgende settes i <code>dbt_project.yml</code>:</p> <pre><code>quoting:\n  database: true\n</code></pre>"},{"location":"vdi/dbt/#hemmeligheter-ved-kjring-fra-utviklerimage","title":"Hemmeligheter ved kj\u00f8ring fra utviklerimage","text":"<p>Av sikkerhetshensyn anbefaler vi og oracle \u00e5 bruke milj\u00f8variabler for \u00e5 holde p\u00e5  hemmeligheter. Vi har derfor laget et script og profiles.yml som kan ligge i dbt-prosjektet.</p> <p>Scriptet kan lastes ned fra navikt/dvh_template/dbt/setup_db_user.ps1.</p> <p><code>profiles.yml</code> skal opprettes i p\u00e5 toppniv\u00e5 i dbt-prosjektmappen med f\u00f8lgende innhold:</p> <pre><code>&lt;navn p\u00e5 dbt prosjekt&gt;:\ntarget: \"{{env_var('DBT_DB_TARGET')}}\"\noutputs:\nU:\ntype: oracle\nuser: \"{{env_var('DBT_DB_USER')}}\"\npass: \"{{env_var('DBT_DB_PASS')}}\"\nprotocol: tcp\nhost: dm07-scan.adeo.no\nport: 1521\nservice: dwhu1\ndatabase: dwhu1\nschema: \"{{env_var('DBT_DB_SCHEMA')}}\"\nthreads: 4\nR:\ntype: oracle\nuser: \"{{env_var('DBT_DB_USER')}}\"\npass: \"{{env_var('DBT_DB_PASS')}}\"\nprotocol: tcp\nhost: dm07-scan.adeo.no\nport: 1521\nservice: dwhr\nschema: \"{{env_var('DBT_DB_SCHEMA')}}\"\nthreads: 4\nQ:\ntype: oracle\nuser: \"{{env_var('DBT_DB_USER')}}\"\npass: \"{{env_var('DBT_DB_PASS')}}\"\nprotocol: tcp\nhost: dm07-scan.adeo.no\nport: 1521\nservice: dwhq0\nschema: \"{{env_var('DBT_DB_SCHEMA')}}\"\nthreads: 4\nP:\ntype: oracle\nuser: \"{{env_var('DBT_DB_USER')}}\"\npass: \"{{env_var('DBT_DB_PASS')}}\"\nprotocol: tcp\nhost: dm08-scan.adeo.no\nport: 1521\nservice: dwh_ha\nschema: \"{{env_var('DBT_DB_SCHEMA')}}\"\nthreads: 4\nconfig:\nsend_anonymous_usage_stats: False\n</code></pre> <p>N\u00e5r profilen er p\u00e5 plass i prosjektmappen kan du teste at dbt fungerer.</p>"},{"location":"vdi/dbt/#teste-dbt-installasjonen","title":"Teste dbt installasjonen","text":"<p>Etter at dbt er p\u00e5 plass kan du verifisere at dbt fungerer ved \u00e5 kj\u00f8re <code>.\\setup_db_user.ps1</code> etterfulgt av <code>dbt debug</code> fra prosjektmappen. Er det et nytt prosjekt m\u00e5 du opprette profiles.yml f\u00f8rst.</p> <p><code>.\\setup_db_user.ps1</code> m\u00e5 kj\u00f8res hver gang en starter en ny terminal eller \u00f8nsker \u00e5 bytte target (db). Scriptet vill midlertidlig opprette milj\u00f8variablene i terminal-sesjonen for target, brukernavn, passord, schema og peke dbt mot profiles.yml i prosjektmappen.</p> <p>Success</p> <pre><code>$ .\\setup_db_user.ps1\nTarget db: dwhu1\nSchema: \n\ncmdlet Get-Credential at command pipeline position 1\nSupply values for the following parameters:\nCredential\n\n$ dbt debug\n09:15:08  Running with dbt=1.1.1\ndbt version: 1.1.1\npython version: 3.8.10\npython path: c:\\users\\****\\appdata\\local\\programs\\python\\python38\\python.exe      \nos info: Windows-10-10.0.19044-SP0\nUsing profiles.yml file at C:\\Users\\****\\git\\dvh-sykefravar-dmx\\profiles.yml\nUsing dbt_project.yml file at C:\\Users\\****\\git\\dvh-sykefravar-dmx\\dbt_project.yml\n\n09:15:08  oracle adapter: Running in cx mode\nConfiguration:\n  profiles.yml file [OK found and valid]   dbt_project.yml file [OK found and valid]\n\nRequired dependencies:\n- git [OK found]\n\nConnection:\n  user: ****\n  database: dwhu1\n  schema: ****\n  protocol: tcp\n  host: dm07-scan.adeo.no\n  port: 1521\ntns_name: None\n  service: dwhu1\n  connection_string: None\n  shardingkey: []\nsupershardingkey: []\ncclass: None\n  purity: None\n  Connection test: [OK connection ok]\n\nAll checks passed!\n</code></pre> <p>DBT er n\u00e5 klart til bruk.</p> <p>Error</p> <pre><code>Connection test: [ERROR]\n\n2 checks failed:\nError from git --help: Could not find command, ensure it is in the user's PATH and that the user has permissions to run it: \"git\"\n\ndbt was unable to connect to the specified database.\nThe database returned the following error:\n\n  &gt;Database Error\n  DPI-1047: Cannot locate a 64-bit Oracle Client library: \"failed to get message for Windows Error 126\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help\n\nCheck your database credentials and try again. For more information, visit:\nhttps://docs.getdbt.com/docs/configure-your-profile\n</code></pre> <p>Oracle client library er mest sannsynlig ikke installert.</p>"},{"location":"vdi/git/","title":"GIT","text":"<ol> <li>Installering av GIT - har du den allerede er det flott.</li> <li>Denne finner du p\u00e5 felles disken under programvare. programvare\\git. Installer f.eks Git-2.30.2-64-bit. Legg installasjon directory inn i milj\u00f8variabel  PATH. F.eks <code>C:\\Users\\&lt;brukernavn&gt;\\AppData\\Local\\GitHubDesktop\\bin</code></li> <li>Dette steget er sannsynligvis ikke n\u00f8dvendig, og utf\u00f8res kun om det oppst\u00e5r problemer i senere steg. Oppdatere milj\u00f8variabler slik at utviklingsimaget kan kommunisere med Github. Dette er beskrevet i https://confluence.adeo.no/pages/viewpage.action?pageId=272519832 punkt 10c</li> <li>F\u00f8lgende legges inn som milj\u00f8 variabler</li> <li>https_proxy til http://webproxy-utvikler.nav.no:8088</li> <li>http_proxy: http://155.55.60.117:8088/</li> <li>no_proxy: localhost,127.0.0.1,*.adeo.no,.local,.adeo.no,.nav.no,.aetat.no,.devillo.no,.oera.no,devel</li> <li>Opprett et PAT (personal access token) som du m\u00e5 bruke som passord ved autentisering. Se https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token Alternativt kan du bruke GitHub Dekstop som setter dette opp for deg automatisk.</li> <li>Clone repositoriet du skal jobbe med. Husk \u00e5 bruke PAT opprettet i punkt 3. som passord om du ikke bruker GitHub Desktop.</li> </ol>"},{"location":"vdi/miljovariabler/","title":"Legge til milj\u00f8variabler","text":"<ol> <li>S\u00f8k etter <code>milj\u00f8variabler</code></li> <li>Klikk p\u00e5: <code>Rediger milj\u00f8bariabler for kontoen din</code></li> </ol> <ol> <li>Trykk p\u00e5 <code>Ny...</code></li> <li>Gi variabelen et navn i <code>Variabelnavn</code>.</li> <li>Skriv inn path til programmet i <code>Variabelverdi</code></li> <li>Trykk <code>OK</code></li> </ol> <ol> <li>Marker <code>Path</code> variabelen</li> <li>Trykk <code>Rediger...</code></li> </ol> <ol> <li>Trykk <code>Ny</code></li> <li>Skriv inn navnet p\u00e5 variabelen du opprettet med syntaksen <code>%&lt;variabelnavn&gt;%</code> eks: <code>%PIP%</code></li> <li>Trykk <code>OK</code></li> </ol> <ol> <li>Trykk <code>OK</code></li> </ol> <p>Note</p> <p>Husk at du m\u00e5 lukke <code>cmd</code> (ledetekst) og \u00e5pne p\u00e5 nytt for at endringen skal tre i kraft.</p>"},{"location":"vdi/oracle-client-library/","title":"Oracle client library","text":"<p>Dette finnes p\u00e5 fellesdisken og mappen programvare\\oracle\\ og kan kopieres lokalt. Det er er instantclient-basiclite-windows som benyttes.</p> <p>Oppdater <code>PATH</code> milj\u00f8variabelen med path til oracle client library. Eksmpel:</p> <pre><code>C:\\data\\instantclient-basiclite-windows\\instantclient_19_11\n</code></pre> <p>Note</p> <p>Se legg til milj\u00f8variabler hvis du ikke vet hvordan du oppdatere PATH.</p>"},{"location":"vdi/pip/","title":"PIP og oppsett av sertifikater","text":""},{"location":"vdi/pip/#sjekk-om-du-har-pip","title":"Sjekk om du har PIP","text":"<p>Kj\u00f8r <code>pip --version</code> for \u00e5 se om pip er tilgjengelig:</p> <pre><code>pip --version\n</code></pre> <p>Success</p> <pre><code>pip --version\n\npip 21.1.1 from c:\\users\\*****\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\\pip (python 3.8)\n</code></pre> <p>Fortsett til \"Sett opp config fil for pip\"</p> <p>Failure</p> <pre><code>pip --version\n\n'pip' is not recognized as an internal or external command, operable program or batch file.\n</code></pre> <p>Kj\u00f8r <code>py -3 -m ensurepip</code> for \u00e5 se om pip allerede eksisterer.</p> <pre><code>Looking in links: c:\\Users\\****\\AppData\\Local\\Temp\\tmp4r6s0n91\nRequirement already satisfied: setuptools in c:\\users\\****\\appdata\\local\\programs\\python\\python38\\lib\\site-packages (58.1.0)\nRequirement already satisfied: pip in c:\\users\\****\\appdata\\local\\programs\\python\\python38\\lib\\site-packages (21.2.4)\n</code></pre> <p>I dette tilfelle m\u00e5 milj\u00f8variabelen <code>PATH</code> oppdateres. Bruk gjerne <code>Fil utforsker</code> for \u00e5 finne riktig path men normalt ligger PIP under:</p> <pre><code>c:\\users\\&lt;brukernavn&gt;\\appdata\\local\\programs\\python\\python38\\scripts\n</code></pre> <p>Info</p> <p>Se legg til milj\u00f8variabler hvis du ikke vet hvordan du oppdatere <code>PATH</code>.</p> <p>Husk at du m\u00e5 lukke og \u00e5pne cmd (ledetekst) etter path variabel er lagt inn. Du kan n\u00e5 verifisere at pip er tilgjengelig ved \u00e5 kj\u00f8re <code>pip --version</code>.</p>"},{"location":"vdi/pip/#oppsett-av-sertifikater-til-pip","title":"Oppsett av sertifikater til pip","text":"<p>Til vanlig bruker pip sitt eget sertifikat for \u00e5 validere at vi laster ned pakker fra riktig server. Siden VDI bruker en webproxy for \u00e5 kommunisere med omverdenen vill vi f\u00e5 en feilmeling ved <code>pip install xxx</code>.</p> <p>Error</p> <pre><code>13:42:24  Encountered an error: External connection exception occurred:\nHTTPSConnectionPool(host='hub.getdbt.com', port=443): Max retries exceeded\nwith url: /api/v1/index.json (Caused by SSLError(SSLCertVerificationError(1,\n'[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get\nlocal issuer certificate (_ssl.c:1108)')))\n</code></pre> <p>For \u00e5 fikse feilen kan vi installere pakkene <code>setuptools-scm</code> og <code>pip-system-certs</code> som f\u00e5r pip til \u00e5 bruke Windows Certificate Store istedenfor.</p> <pre><code>pip install setuptools-scm pip-system-certs --trusted-host pypi.org --trusted-host  files.pythonhosted.org\n</code></pre>"},{"location":"vdi/python/","title":"Python","text":"<p>Sjekk om Python er installert med <code>py --version</code>. Python versionen m\u00e5 v\u00e6re &gt;= 3.8 og &lt; 3.11. 3.11 er ikke st\u00f8ttet av dbt p\u00e5 n\u00e5v\u00e6rende tidspunkt</p> <pre><code>py --version\n</code></pre> <p>Success</p> <pre><code>$ py --version\n\nPython 3.8.10\n</code></pre> <p>Fortsett til PIP</p> <p>Failure</p> <p><pre><code>$ py --version\n\nPython 3.6.4\n</code></pre> For gammel version av Python</p> <p>Last ned Python</p> <p>Failure</p> <pre><code>$ py --version\n\npython is not recognized as an internal or external command, operable program, or batch file\n</code></pre> <p>Python er ikke installert</p> <p>Last ned Python</p>"},{"location":"vdi/sqlfluff/","title":"SQLFluff","text":"<p>SQLFluff er en linter som hjelper oss med \u00e5 formattere SQL-koden p\u00e5 en fornuftig m\u00e5te.</p>"},{"location":"vdi/sqlfluff/#installering-av-sqlfluff","title":"Installering av SQLFluff","text":"<pre><code>pip install sqlfluff sqlfluff-templater-dbt\n</code></pre>"},{"location":"vdi/vscode/","title":"Visual Studio Code","text":"<p>Bruk https://code.visualstudio.com/download, velg Windows versjonen. Last ned, pakk ut og start programmet code. F\u00f8lg instruksjonene ved innstalleringen.</p>"}]}